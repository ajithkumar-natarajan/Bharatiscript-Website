/*!
 * MoEngage Web SDK
 * v0.80.0
 */
!function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=38)}([function(e,t,n){"use strict";function o(e){return 0===Object.keys(e).length&&e.constructor===Object}function a(e,t,n){return null==e?null:(t=Array.isArray(t)?t:t.split("."),e=e[t[0]],e&&t.length>1?a(e,t.slice(1),n):void 0===e?n||null:e)}function r(){if(window){if("localhost"===window.location.hostname)return"https";if("http:"===window.location.protocol)return"http";if("https:"===window.location.protocol)return"https"}}function i(e){for(var t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),o=atob(n),a=new Uint8Array(o.length),r=0;r<o.length;++r)a[r]=o.charCodeAt(r);return a}function s(e){for(var t,n,o,a,r,i="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=new Uint8Array(e),l=u.byteLength,f=l%3,d=l-f,c=0;c<d;c+=3)r=u[c]<<16|u[c+1]<<8|u[c+2],t=(16515072&r)>>18,n=(258048&r)>>12,o=(4032&r)>>6,a=63&r,i+=s[t]+s[n]+s[o]+s[a];return 1==f?(r=u[d],t=(252&r)>>2,n=(3&r)<<4,i+=s[t]+s[n]+"=="):2==f&&(r=u[d]<<8|u[d+1],t=(64512&r)>>10,n=(1008&r)>>4,o=(15&r)<<2,i+=s[t]+s[n]+s[o]+"="),i}function u(e,t){return t.isChrome()||t.isOpera()?"vapid"===e.chrome.subscriptionMode&&!!e.chrome.vapidPublicKey:!!t.isFirefox()&&("vapid"===e.firefox.subscriptionMode&&!!e.firefox.vapidPublicKey)}function l(e,t){return t.isChrome()||t.isOpera()?e.chrome.vapidPublicKey:t.isFirefox()?e.firefox.vapidPublicKey:""}function f(){var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}function d(e){return new Date(Date.parse(e))}function c(e,t){return g(this,void 0,void 0,function(){var n;return T(this,function(o){switch(o.label){case 0:n=0,o.label=1;case 1:return n<e.length?[4,t(e[n],n,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}function S(){return window[window.moengage_object||"Moengage"]}function E(e,t){if(null===e||void 0===e||null===t||void 0===t)return e===t;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;var n=Object.keys(e);return Object.keys(t).every(function(e){return-1!==n.indexOf(e)})&&n.every(function(n){return E(e[n],t[n])})}var g=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(a,r){function i(e){try{u(o.next(e))}catch(e){r(e)}}function s(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,t||[])).next())})},T=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){u.label=n[1];break}if(6===n[0]&&u.label<i[1]){u.label=i[1],i=n;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(n);break}i[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],r=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,i,s,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},p=this;Object.defineProperty(t,"__esModule",{value:!0}),t.isObjectEmpty=o,t.getProp=a,t.getCurrentProtocol=r,t.stringToBuffer=i,t.bufferToString=s,t.isVapid=u,t.getVapidPublicKey=l,t.isMobile=f,t.parseISOString=d,t.asyncForEach=c,t.getMoeWindowVar=S;var _=function(){function e(){var e=this;this.p=null,this.res=null,this.rej=null,this.p=new Promise(function(t,n){e.res=t,e.rej=n})}return e}();t.PromiseObject=_,t.validateDataType={isBoolean:function(e){return"boolean"==typeof e},isNumber:function(e){return"number"==typeof e},isString:function(e){return"string"==typeof e},isNumeric:function(e){return p.isNumber(e)||p.isString(e)&&String(1*e)===e},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)}},t.deepCompareObjects=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.EPHEMERAL_STORAGE={INIT_DATA:"initData",BROWSER_DETAILS:"browserDetails",UNIFIED_LOGS:"unifiedLogs"},e.PERSISTENT_STORAGE={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails"},e.EVENT_NAMES={USER_ATTRIBUTE:"EVENT_ACTION_USER_ATTRIBUTE",UNSUBSCRIBED:"MOE_WEB_UNSUBSCRIBED",WEB_SESSION_START:"EVENT_ACTION_WEB_SESSION_START",PAGE_VIEWED:"MOE_PAGE_VIEWED",WEB_OPTIN_BANNER_LOAD:"MOE_WEB_OPTIN_BANNER_LOAD",WEB_OPTIN_CLOSED:"MOE_WEB_OPTIN_CLOSED",WEB_OPTIN_ACCEPTED:"MOE_WEB_OPTIN_ACCEPTED",USER_SUBSCRIBED:"MOE_USER_SUBSCRIBED",OPT_IN_SHOWN:"MOE_OPT_IN_SHOWN",OPT_IN_ALLOWED:"MOE_OPT_IN_ALLOWED",OPT_IN_DISMISSED:"MOE_OPT_IN_DISMISSED",OPT_IN_BLOCKED:"MOE_OPT_IN_BLOCKED",USER_SUBSCRIPTION_CHECK:"MOE_USER_SUBSCRIPTION_CHECK",LOGOUT:"MOE_LOGOUT",UPDATE_DEVICE_ATTRIBUTE:"EVENT_ACTION_DEVICE_ATTRIBUTE"},e.ATTRIBUTE_NAMES={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},e.SDK_FEATURES={WEB_PUSH:"WEB_PUSH"},e.BROADCAST_TOPICS={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED"}},OPT_IN_LIFECYCLE:{TOPIC_NAME:"MOE_OPT_IN",EVENT_NAMES:{HARD_ASK_SHOWN:"HARD_ASK_SHOWN",HARD_ASK_DISMISSED:"HARD_ASK_DISMISSED",HARD_ASK_ALLOWED:"HARD_ASK_ALLOWED",HARD_ASK_DENIED:"HARD_ASK_DENIED",SOFT_ASK_SHOWN:"SOFT_ASK_SHOWN",SOFT_ASK_DISMISSED:"SOFT_ASK_DISMISSED",SOFT_ASK_ALLOWED:"SOFT_ASK_ALLOWED"}},INAPP_LIFECYCLE:{TOPIC_NAME:"INAPP_LIFECYCLE",EVENT_NAMES:{MODULE_LOADED:"MODULE_LOADED"}}},e.ERRORS={WEB_PUSH_NOT_SUPPORTED:{code:1e3,reason:"Web push not supported in current browser environment"},SERVICE_WORKER_REGISTRATION_FAILED:{code:1001,reason:"Registering the service worker failed"},WEB_PUSH_NOT_CONFIGURED:{code:1002,reason:"Web push settings not configured"},NOTIFICATION_MANAGER_NOT_CONFIGURED:{code:1003,reason:"Could not configure a notification manager for the current browser and settings"},PERMISSION_DISMISSED_TOO_MANY_TIMES:{code:1004,reason:"Hard ask was dismissed to many times"},SERVICE_WORKER_NOT_IN_CORRECT_SCOPE:{code:1005,reason:"Service worker can not be registered on this page due to scope issues"}},e.HTML_COMM={CHANNEL:{MAIN:"moe",SUBD:"moe-subd"},TOPICS:{PERSISTENT_STORAGE:"STORAGE",EPHEMERAL_STORAGE:"EPHEMERAL_STORAGE",PERMISSION_STATE:"PERMISSION_STATE",CONFIG:"CONFIG",HARD_ASK_RESULT:"HARD_ASK_RESULT",SHOW_NOTIF:"SHOW_NOTIF"}},e.GIFS={AMAZED:"https://media.giphy.com/media/90F8aUepslB84/giphy.gif",SAD:"https://media.giphy.com/media/KDRv3QggAjyo/giphy.gif"},e.CLUSTER_ENVIRONMENT_MAP={in:"apiv2mumbai",eu:"apiv2eu"},e.LINKS={MOE_DASHBOARD:"https://app.moengage.com",MIGRATION_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",WEBSDK_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",SELF_HANDLED_DOCS:"https://docs.moengage.com/docs/self-handled-opt-ins"},e}();t.default=o,t.WINDOW_OBJECTS={PageEventHistroyManager:"MoengagePageEventHistroyManager"},t.INAPP_CONSTANTS={HOST:"https://inapps.moengage.com/",HOST_EU:"https://inapps-eu.moengage.com/",API:{META:"v3/campaigns/inapp/live",CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/live/",DRAFT_CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/test/"},DRAFT_CAMPAIGN_TPYES:{WEB_PERSONALIZATON:"web_personalization",ONSITE_MESSAGING:"onsite_messaging"},META_REFRESH_TIME:9e5,DATABASE_NAME:"moe_onsite",STORES:{CAMPAIGNS_META:{NAME:"campaigns_meta"},CAMPAIGNS_TAGS:{NAME:"campaigns_tags"},CAMPAIGNS_STATS:{NAME:"campaigns_stats"},TEST_CAMPAIGN_STORE:{NAME:"test_campaign"},SERVICE_META:{NAME:"service_meta",KEYS:{LAST_META_CALL_TIME:"last_meta_call_time",GLOBAL_DELAY:"global_delay_between_inapps",LAST_INAPP_SHOWN_TIME:"last_inapp_shown",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version"}}},EVENT_NAMES:{CLICK:"MOE_IN_APP_CLICKED",IMPRESSION:"MOE_IN_APP_SHOWN",DISMISS:"MOE_IN_APP_DISMISSED"},WEB_HELPER_IFRAME_URL:"https://cdn.moengage.com/webpush/beta/webpushhelper.html",IFRAME_CHANNEL:"inapp_helper",IFRAME_TOPICS:{COOKIE_STORAGE:"COOKIE_STORAGE"},COOKIE_STORAGE:{TEST_DRAFT_TYPE:"moe_inapp_draft_type",TEST_DRAFT_ID:"moe_inapp_draft_id",TEST_DRAFT_TAG:"moe_inapp_draft_tag",TEST_CAMPAIGN_META:"test_campaign_meta",TEST_TEMPLATE_TYPE:"test_template_type"},CSS_SELECTORS:{CLICK_INAPP:"moe-inapp-click",DISMISS_INAPP:"moe-inapp-close"}},t.SDK_MODULES={INAPP:{name:"INAPP",src:"https://cdn.moengage.com/webpush/modules/inapp.js",windowLocation:"moeOnsite"}}},function(e,t,n){"use strict";var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,a,r=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(e){a={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return i},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(1),s="color: white; background: #41AE55; border-radius: 5px;",u="color: white; background: #48beab; border-radius: 5px;",l=function(){function e(){}return e.setLogLevel=function(t,n){var o=e.baseLogTag+".setLogLevel";null==r.default.get(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS)&&r.default.set(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),null==t?e.logLevel=0:t in[0,1,2]?(e.logLevel=t,t>0&&n&&e.releaseAllLogs()):e.warn(0,o,"Value",t,"not supported for setDebugLevel(). Current log level is",e.logLevel,". Debug level can only be [0, 1, 2]")},e.log=function(t,n,o){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t<=e.logLevel?console.log.apply(console,a(["%c "+e.logBrand+" %c %c info %c %c "+n+" ",s,"","color: white; background: #18a0bf; border-radius: 5px;","",u,o],r)):e.cacheLog(function(){e.log.apply(e,a([t,n,o],r))})},e.error=function(t,n,o){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t<=e.logLevel?console.error.apply(console,a(["%c "+e.logBrand+" %c %c error %c %c "+n+" ",s,"","color: white; background: #cc0a0a; border-radius: 5px;","",u,o],r)):e.cacheLog(function(){e.error.apply(e,a([t,n,o],r))})},e.warn=function(t,n,o){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t<=e.logLevel?console.warn.apply(console,a(["%c "+e.logBrand+" %c %c warn %c %c "+n+" ",s,"","color: white; background: #e8ab51; border-radius: 5px;","",u,o],r)):e.cacheLog(function(){e.warn.apply(e,a([t,n,o],r))})},e.customLabel=function(t,n,o){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t<=e.logLevel?console.log.apply(console,a(["%c "+e.logBrand+" %c %c "+n+" %c %c "+o+" %c ",s,"",u,"","color: white; background: #a400ff; border-radius: 5px;",""],r)):e.cacheLog(function(){e.customLabel.apply(e,a([t,n,o],r))})},e.image=function(t,n){t<=e.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+n+"); background-size: 160px 90px; color: transparent;"):e.cacheLog(function(){e.image(t,n)})},e.releaseAllLogs=function(){var t=r.default.get(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS),n=t.length,o=t;if(r.default.set(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),n>0){e.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(var a=0;a<n;a++)o[a]();e.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}},e.setLogBrand=function(t){e.logBrand=t},e.setBrandColor=function(e){s="color: white; background: "+e+"; border-radius: 5px;"},e.cacheLog=function(e){var t=r.default.get(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS);null==t&&(t=[]),t.push(e),r.default.set(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,t)},e.baseLogTag="Logger",e.logBrand="MoEngage",e.logLevel=0,e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),r=n(1),i=n(12),s=n(11),u=function(){function e(){}return e.setPrefix=function(t){e.prefix=t+"_"},e.set=function(t,n){e.baseLogTag;if(t=e.prefix+t,localStorage){var o=e.getMoeData();o[t]=n,localStorage.setItem("MOE_DATA",JSON.stringify(o))}e.isSharedWithCookie&&e.KEYS_SHARED_WITH_COOKIE.indexOf(t)>=0&&s.default.set(t,n)},e.get=function(t){e.baseLogTag;if(t=e.prefix+t,localStorage){var n=e.getMoeData();return a.getProp(n,t,null)}return null},e.remove=function(t){var n=e.baseLogTag+".remove",a=e.prefix+t;if(localStorage&&null!=e.get(t)){var r=e.getMoeData();delete r[a],localStorage.setItem("MOE_DATA",JSON.stringify(r)),o.default.log(2,n,"Key",t,"removed.")}e.isSharedWithCookie&&e.KEYS_SHARED_WITH_COOKIE.indexOf(t)>=0&&s.default.remove(t)},e.logout=function(){var t=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA"];for(var n in r.default.PERSISTENT_STORAGE)t.indexOf(n)<0&&e.remove(r.default.PERSISTENT_STORAGE[n]);for(var o in r.default.PERSISTENT_STORAGE.Q)i.default.purge(o)},e.getString=function(t){if(t=e.prefix+t,localStorage){var n=e.get(t);return"string"==typeof n||n instanceof String?n:JSON.stringify(n)}},e.removePrefix=function(){e.prefix=""},e.copyKeysFromCookie=function(){for(var t=0;t<e.KEYS_SHARED_WITH_COOKIE.length;t++){var n=e.KEYS_SHARED_WITH_COOKIE[t];null!=s.default.get(n)&&e.set(n,s.default.get(n))}},e.getMoeData=function(){var t=e.baseLogTag+".getMoeData",n=localStorage.getItem("MOE_DATA");if(null==n)return{};try{return n=JSON.parse(n)}catch(e){return o.default.error(1,t,e),{}}},e.baseLogTag="PersistentStorage",e.prefix="",e.isSharedWithCookie=!1,e.KEYS_SHARED_WITH_COOKIE=[r.default.PERSISTENT_STORAGE.USER_DATA,r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,r.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.default.PERSISTENT_STORAGE.SETUP_TIME,r.default.PERSISTENT_STORAGE.PUSH_TOKEN,r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS],e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(17),r=n(2),i=n(12),s=n(0),u=n(23),l=n(3),f=n(5),d=n(9),c=n(19),S=n(7),E=n(6),g=function(){function e(){}return e.deviceAdd=function(){return new Promise(function(t,n){var r=d.default.get();e.collectGetParams().then(function(n){var s={queryParams:n};a.default.post(r.baseDomainName+"v2/device/add",s).then(function(){E.default.get().then(function(n){n.deviceAdded=!0,n.save().then(function(){u.default.startPeriodicClear(o.default.PERSISTENT_STORAGE.Q.REPORT),e.onDeviceAdd.res(),t()})})}).catch(function(e){i.default.enqueue(o.default.PERSISTENT_STORAGE.Q.DEVICE,!0),t()})})})},e.reportAdd=function(t,n){var a=e.baseLogTag+".reportAdd";return new Promise(function(s,u){n=!!n,e.getWebSDKSettings().then(function(u){u.isPushSubBilling?E.default.get().then(function(u){u.deviceAdded?e.reportAddInternal(t,n).then(function(){s()}):(i.default.enqueue(o.default.PERSISTENT_STORAGE.Q.REPORT,t),r.default.log(1,a,"Report added to queue as device not added yet:",t.event.name),r.default.log(2,a,"Event Queued:",t.event.name),t.type==c.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&(e.isPushSubAttributeAccepted(t.event.attributes[0].key)?(r.default.log(1,a,"Attribute accepted for push sub billing."),e.deviceAdd()):r.default.log(2,a,"Attribute NOT accepted for push sub billing.")),s())}):e.reportAddInternal(t,n).then(function(){s()})})})},e.reportAddInternal=function(t,n){var s=e.baseLogTag+".reportAddInternal";return new Promise(function(l,f){e.getWebSDKSettings().then(function(f){var S=d.default.get().baseDomainName;S+=n?"v2/device/add":"v2/report/add";var E=e.getUpdatedPushDetails();for(var g in E)E.hasOwnProperty(g)&&(t.getParams[g]=E[g]);var T={queryParams:t.getParams,postData:t.postData};a.default.post(S,T).then(function(){t.type===c.default.REPORT_ADD_TYPE.EVENT?r.default.log(1,s,"Event tracked successfully:",t.event):t.type===c.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&r.default.log(1,s,"User attribute added successfully:",t.event.attributes),l()}).catch(function(e){t.type===c.default.REPORT_ADD_TYPE.EVENT?r.default.log(1,s,"Queueing unsuccessful event tracking:",t.event):t.type===c.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&r.default.log(1,s,"Queueing unsuccessful user attribute add:",t.event.attributes),i.default.enqueue(o.default.PERSISTENT_STORAGE.Q.REPORT,t),u.default.startPeriodicClear(o.default.PERSISTENT_STORAGE.Q.REPORT),l()})})})},e.checkIfTokenValid=function(e){var t=d.default.get().baseDomainName+"v2/device/token-check",n=d.default.get();return new Promise(function(o){e?E.default.get().then(function(r){var i={queryParams:{app_id:n.appId,unique_id:r.deviceUuid,push_id:e}};a.default.post(t,i).then(function(e){o(200===e.status?!0:!1)}).catch(function(e){o(!1)})}):o(!1)})},e.getWebSDKSettings=function(){return new Promise(function(t,n){var a=d.default.get();if(null!=a&&null!=a.appId||(a=new d.default(l.default.get(o.default.PERSISTENT_STORAGE.INIT_DATA))),e.sdkSettings)t(e.sdkSettings);else{var r=(new Date).getTime(),i=l.default.get(o.default.PERSISTENT_STORAGE.SETUP_TIME);null==i||a.debugLevel>0?e.getAndPersistWebSettings(a).then(function(e){t(e)}):r-i>864e5?e.getAndPersistWebSettings(a).then(function(e){t(e)}):l.default.get(o.default.PERSISTENT_STORAGE.WEB_SETTINGS)?(e.sdkSettings=l.default.get(o.default.PERSISTENT_STORAGE.WEB_SETTINGS),t(e.sdkSettings)):e.getAndPersistWebSettings(a).then(function(e){t(e)})}})},e.getAndPersistWebSettings=function(t){var n=e.baseLogTag+".getAndPersistWebSettings";return new Promise(function(i){null==t.appId&&(t=new d.default(l.default.get(o.default.PERSISTENT_STORAGE.INIT_DATA)));var s={queryParams:{app_id:t.appId}};r.default.log(1,n,"Fetching latest web sdk settings for",t.appId),a.default.get(t.baseDomainName+"websdksettings",s).then(function(t){r.default.log(1,n,"Fetched latest web settings");var a=t.responseText;"string"==typeof a&&(a=JSON.parse(a));var s=(new Date).getTime();a=S.default.parseOldSettings(a),l.default.set(o.default.PERSISTENT_STORAGE.WEB_SETTINGS,a),l.default.set(o.default.PERSISTENT_STORAGE.SETUP_TIME,s),e.sdkSettings=a,i(a)}).catch(function(n){console.error("MoeError",n),setTimeout(function(){return e.getAndPersistWebSettings(t)},3e3)})})},e.collectGetParams=function(){var e=this;return new Promise(function(t,n){E.default.get().then(function(n){var a=d.default.get();null!=a&&null!=a.appId||(a=new d.default(l.default.get(o.default.PERSISTENT_STORAGE.INIT_DATA)));var r=new Date,i=Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds());f.default.getInstance().then(function(r){var u={os:r.os,os_platform:r.osPlatform,is_incognito:r.isIncognito,app_id:a.appId,os_ver:r.name,sdk_ver:"0.80.0",model:r.name,app_ver:1,device_ts:Number(i),device_tz_offset:-6e4*(new Date).getTimezoneOffset(),unique_id:n.deviceUuid,device_tz:(new Date).getTimezoneOffset()},d=l.default.get(o.default.PERSISTENT_STORAGE.PUSH_TOKEN);null!=d&&"NA"!==d&&""!==d&&"null"!==d&&(u.push_id=d),r.isChromeLike()&&(s.isVapid(e.sdkSettings.platformSettings,r)?(u.subscription_type="vapid",u.vapid_public=s.getVapidPublicKey(e.sdkSettings.platformSettings,r)):u.subscription_type="normal",u.sender_id=e.sdkSettings.platformSettings.chrome.projectNumber),null!=a.environment&&(u.environment=a.environment),r.name===f.default.BROWSER_NAMES.SAFARI&&(u.websitePushId=e.sdkSettings.platformSettings.safari.websitePushId);var c=l.default.get(o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=c&&null!=c.keys){for(var S in c.keys)c.keys.hasOwnProperty(S)&&(u["keys_"+S]=encodeURI(c.keys[S]));null!=c.endpoint&&(u.endpoint=encodeURI(c.endpoint)),u.expirationTime=c.expirationTime}t(u)})})})},e.getUpdatedPushDetails=function(){var e={},t=l.default.get(o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=t){var n=l.default.get(o.default.PERSISTENT_STORAGE.PUSH_TOKEN);if(null!=n&&"NA"!==n&&""!==n&&"null"!==n&&(e.push_id=n),null!=t.keys){for(var a in t.keys)t.keys.hasOwnProperty(a)&&(e["keys_"+a]=encodeURI(t.keys[a]));null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e},e.isPushSubAttributeAccepted=function(e){return e===o.default.ATTRIBUTE_NAMES.EMAIL},e.baseLogTag="MoeApi",e.onDeviceAdd=new s.PromiseObject,e}();t.default=g},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(a,r){function i(e){try{u(o.next(e))}catch(e){r(e)}}function s(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){u.label=n[1];break}if(6===n[0]&&u.label<i[1]){u.label=i[1],i=n;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(n);break}i[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],r=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,i,s,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(8),s=n(0),u=n(3),l=function(){function e(t,n,o){this.os="web",this.osPlatform=t.userAgent,this.isMobile=s.isMobile(),this.os=s.isMobile()?"mweb":"web",this.name=e.getBrowserName(t.userAgent,n),this.isIncognito=o}return e.getInstance=function(){return o(this,void 0,void 0,function(){var t,n,o;return a(this,function(a){switch(a.label){case 0:return null!=i.default.get(r.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)?[3,2]:[4,e.isIncognito(window)];case 1:return t=a.sent(),n=new e(navigator,document,t),i.default.set(r.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,n),o=u.default.get(r.default.PERSISTENT_STORAGE.BROWSER_DETAILS),o&&e.isBrowserUpdated(o,n)||u.default.set(r.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,n),[2,n];case 2:return[2,i.default.get(r.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)]}})})},e.isIncognito=function(e){var t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise(function(n){t?t(e.TEMPORARY,100,function(){n(!1)},function(){n(!0)}):n(!1)})},e.getBrowserName=function(t,n){return-1!=t.indexOf("MSIE")||1==n.documentMode?e.BROWSER_NAMES.INTERNET_EXPLORER:t.indexOf("Edge")>-1?e.BROWSER_NAMES.EDGE:t.indexOf("OPR")>-1||t.indexOf("Opera")>-1?e.BROWSER_NAMES.OPERA:t.indexOf("Chrome")>-1?t.indexOf("MMS")>-1?e.BROWSER_NAMES.OPERA_NEON:e.BROWSER_NAMES.CHROME:t.indexOf("Safari")>-1?e.BROWSER_NAMES.SAFARI:t.indexOf("Firefox")>-1?e.BROWSER_NAMES.FIREFOX:e.BROWSER_NAMES.OTHERS},e.isBrowserUpdated=function(e,t){return s.deepCompareObjects(e,t)},e.prototype.isChromeLike=function(){return this.isChrome()||this.isFirefox()||this.isOpera()},e.prototype.isChrome=function(){return this.name===e.BROWSER_NAMES.CHROME},e.prototype.isFirefox=function(){return this.name===e.BROWSER_NAMES.FIREFOX},e.prototype.isOpera=function(){return this.name===e.BROWSER_NAMES.OPERA||this.name===e.BROWSER_NAMES.OPERA_NEON},e.prototype.isSafari=function(){return this.name===e.BROWSER_NAMES.SAFARI},e}();!function(e){!function(e){e.CHROME="Google Chrome",e.FIREFOX="Mozilla Firefox",e.OPERA="Opera",e.OPERA_NEON="Opera Neon",e.SAFARI="Apple Safari",e.INTERNET_EXPLORER="Internet Explorer",e.EDGE="Edge",e.OTHERS="Others"}(e.BROWSER_NAMES||(e.BROWSER_NAMES={}))}(l||(l={})),t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(15),a=n(2),r=n(4),i=n(1),s=n(3),u=n(11),l=n(5),f=n(24),d=n(7),c=n(0),S=n(10),E=null,g=!1,T=null,p=function(){function e(e){this.attributes=[],this.subscribedToOldSdk=!1,null==e?(this.deviceUuid=S.v4(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=c.getProp(e,"deviceUuid",S.v4()),this.attributes=c.getProp(e,"attributes",[]),this.deviceAdded=c.getProp(e,"deviceAdded",!1))}return e.prototype.addAttribute=function(t){var n=this,o=e.baseLogTag+".addAttribute";return new Promise(function(r){t.key=e.getMorphedKey(t.key);for(var i=-1,s=n.attributes.length-1;s>=0;s--)t.key===n.attributes[s].key&&(i=s);a.default.log(2,o,"Adding attribute:",t),i>=0?(n.attributes[i].value===t.value&&!0,n.attributes[i].value=t.value):n.attributes.push(t),n.save().then(function(){r(!0)})})},e.getLocalUser=function(){var t=e.baseLogTag+".getLocalUser";return new Promise(function(n){if(s.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)){a.default.log(2,t,"Found user in localstorage");n(new e(s.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)))}else n(null)})},e.getCookieUser=function(){return new Promise(function(t){var n=e.baseLogTag+".getLocalUser";if(u.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)){a.default.log(2,n,"Found user in cookie");t(new e(u.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)))}else t(null)})},e.getSubdomainUser=function(){return new Promise(function(t){r.default.getWebSDKSettings().then(function(n){E=new f.default(n),E.getInSubdomain(i.default.PERSISTENT_STORAGE.USER_DATA).then(function(n){t(n?new e(n):null)})})})},e.getMigrationUser=function(){var t=e.baseLogTag+".getLocalUser";return new Promise(function(n){var r=localStorage.getItem(i.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);if(r)try{var s=JSON.parse(r);if(s.is_new_sdk_migrated)n(null);else{var u=new e({deviceAdded:c.getProp(s,"device_add",!1),deviceUuid:c.getProp(s,"uuid",S.v4())}),l=c.getProp(s,"user_attrs",{});for(var f in l)l.hasOwnProperty(f)&&u.attributes.push(new o.default(f,l[f]));var d=localStorage.getItem(i.default.PERSISTENT_STORAGE.OLD_SDK.PUSH_TOKEN);null!=d&&"NA"!==d&&"null"!==d&&(u.subscribedToOldSdk=!0),n(u)}}catch(e){a.default.error(1,t,"Error getting the migration user. Resolving as a new user."),a.default.error(1,t,e),n(null)}else n(null)})},e.getSync=function(){return e.instance},e.get=function(){var t=e.baseLogTag+".get";return null!=T?T:T=new Promise(function(n){l.default.getInstance().then(function(o){r.default.getWebSDKSettings().then(function(r){g=r.isDomainLevelStorage;var s="https";o.isChromeLike()&&(r.platformSettings.chrome.domainType===d.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===d.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===c.getCurrentProtocol())&&(s="http");var u=e.getLocalUser(),l=r.isDomainLevelStorage?e.getCookieUser():"resolved",f="http"===s?e.getSubdomainUser():"resolved",S=e.getMigrationUser();Promise.all([u,l,f,S]).then(function(s){var u=s[0],l=s[1],f=s[2],S=s[3],E=function(){if(l&&"resolved"!==l)a.default.log(1,t,"User resolved from cookie: ",l),l.save().then(function(e){n(e)});else{a.default.log(1,t,"Local user: ",u);new e(u).save().then(function(e){n(e)})}};S?S.save().then(function(e){var o=localStorage.getItem(i.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);if(o){var r=JSON.parse(o);r.is_new_sdk_migrated=!0,localStorage.setItem(i.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA,JSON.stringify(r))}a.default.log(1,t,"User resolved from older SDK: ",e),n(e)}):o.isChromeLike()&&(r.platformSettings.chrome.domainType===d.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===d.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===c.getCurrentProtocol())&&f&&"resolved"!==f?(a.default.log(1,t,"User resolved from subdomain: ",f),f.save().then(function(e){n(e)})):E()})})})})},e.logout=function(){var e=this;return new Promise(function(t){T=null,e.instance=null,null!=E?E.logout().then(function(){t()}):t()})},e.prototype.save=function(){var t=this,n=e.baseLogTag+".save";return e.instance=this,new Promise(function(e){s.default.set(i.default.PERSISTENT_STORAGE.USER_DATA,t),g&&u.default.set(i.default.PERSISTENT_STORAGE.USER_DATA,t),null!=E?E.setInSubDomainStorage(i.default.PERSISTENT_STORAGE.USER_DATA,t).then(function(){e(t)}).catch(function(o){a.default.error(1,n,"Error storing value in subdomain"),e(t)}):e(t)})},e.prototype.getAttribute=function(t){var n=null;return t=e.getMorphedKey(t),this.attributes.map(function(e){e.key===t&&(n=e.value)}),n},e.prototype.indexOfAttribute=function(t){var n=-1;return t=e.getMorphedKey(t),this.attributes.map(function(e,o){e.key===t&&(n=o)}),n},e.getMorphedKey=function(e){switch(e){case"id":e=i.default.ATTRIBUTE_NAMES.ID;break;case"email":e=i.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":e=i.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":e=i.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":e=i.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":e=i.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":e=i.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":e=i.default.ATTRIBUTE_NAMES.BDAY}return e},e.baseLogTag="UserModel",e.isResolved=!1,e.instance=null,e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(2),r=n(1),i=function(){function e(){this.isDomainLevelStorage=!1,this.isConfigured=!1,this.isPushSubBilling=!1,this.platformSettings=new c,this.optInConfig=new s}return e.parseOldSettings=function(t){var n=e.baseLogTag+".parseOldSettings",r=new e;if(r.oldWebData=t,t.webData&&!o.isObjectEmpty(t.webData)){r.isConfigured=!0;var i=t.webData,u=o.getProp(i,"domain_type",null);u&&("http"===u.toLowerCase()?r.platformSettings.chrome.domainType=d.DOMAIN_TYPE.HTTP:"https"===u.toLowerCase()?r.platformSettings.chrome.domainType=d.DOMAIN_TYPE.HTTPS:"multi"===u.toLowerCase()?r.platformSettings.chrome.domainType=d.DOMAIN_TYPE.MUTLI:r.platformSettings.chrome.domainType=d.DOMAIN_TYPE.NA),r.platformSettings.chrome.subdomainURL=o.getProp(i,"subdomainUrl",null),"false"===o.getProp(i,"domain_level_storage",!1)?r.isDomainLevelStorage=!1:r.isDomainLevelStorage=!(!o.getProp(i,"domain_level_storage",!1)&&"true"!==o.getProp(i,"domain_level_storage",!1));var l=o.getProp(i,"PushSubBilling",!1);"false"===l?l=!1:"true"===l&&(l=!0),o.validateDataType.isBoolean(l)||(l=!1),r.isPushSubBilling=l,r.platformSettings.chrome.domainType!==d.DOMAIN_TYPE.HTTP&&r.platformSettings.chrome.domainType!==d.DOMAIN_TYPE.MUTLI||r.platformSettings.chrome.subdomainURL||a.default.warn(1,n,"No sub domain defined for HTTP site"),r.platformSettings.chrome.enabled=!0,r.platformSettings.chrome.apiKey=o.getProp(i,"webPushPlatformData.chrome.api_key",""),r.platformSettings.chrome.projectNumber=o.getProp(i,"webPushPlatformData.chrome.project_number",null),r.platformSettings.chrome.subscriptionMode=o.getProp(i,"webPushPlatformData.chrome.subscriptionMode","normal"),r.platformSettings.chrome.vapidPublicKey=o.getProp(i,"webPushPlatformData.chrome.vapidPublicKey",null),r.platformSettings.firefox.enabled=!0,r.platformSettings.firefox.apiKey=o.getProp(i,"webPushPlatformData.chrome.api_key",""),r.platformSettings.firefox.projectNumber=o.getProp(i,"webPushPlatformData.chrome.project_number",null),r.platformSettings.firefox.subscriptionMode=o.getProp(i,"webPushPlatformData.firefox.subscriptionMode","normal"),r.platformSettings.firefox.vapidPublicKey=o.getProp(i,"webPushPlatformData.firefox.vapidPublicKey",null),r.platformSettings.safari.websitePushId=o.getProp(i,"webPushPlatformData.safari.websitePushId",null),null==r.platformSettings.safari.websitePushId?r.platformSettings.safari.enabled=!1:r.platformSettings.safari.enabled=!0;o.getProp(i,"call_push_moengage",!0)?o.getProp(i,"banner.banner_flag",null)?r.optInConfig.type=s.TYPE.TWO_STEP:r.optInConfig.type=s.TYPE.ONE_CLICK:r.optInConfig.type=s.TYPE.SELF_HANDLED,r.optInConfig.reappearTime=parseInt(o.getProp(i,"promptAgain",24)),r.optInConfig.showOverlay=o.getProp(i,"show_overlay",!1),r.optInConfig.loadTime=o.getProp(i,"load_time",0),r.optInConfig.softAskConfig.desktop.customHTML=o.getProp(i,"bannerHtml.web",null),r.optInConfig.softAskConfig.mobile.customHTML=o.getProp(i,"bannerHtml.mweb",null),r.platformSettings.chrome.isServiceWorkerRoot=!o.getProp(i,"is_service_worker_not_root",!1),r.platformSettings.chrome.serviceWorkerFilename=o.getProp(i,"serviceworker_file","serviceworker.js"),""===r.platformSettings.chrome.serviceWorkerFilename&&(r.platformSettings.chrome.serviceWorkerFilename="serviceworker.js"),r.inappEnabled=o.getProp(i,"inappEnabled",!1),r.featureAvailabilityMatrix=new f,r.featureAvailabilityMatrix=o.getProp(i,"featureAvailabilityMatrix",null)}else r.isConfigured=!1;return r},e.isFeatureEnabled=function(e,t){if(t===r.default.SDK_FEATURES.WEB_PUSH){var n=o.getProp(e,"featureAvailabilityMatrix.webPush",null);if(n){var a=n.domains;return!(a.values.indexOf(window.location.hostname)>=0!=("whitelist"===a.type))}return!0}return!0},e.baseLogTag="SdkSettings",e}(),s=function(){function e(){this.type=e.TYPE.NA,this.reappearTime=24,this.softAskConfig={desktop:new u,mobile:new u}}return e}();t.OptInConfig=s;var u=function(){function e(){this.customHTML=null}return e}();!function(e){!function(e){e.NA="NA",e.ONE_CLICK="ONE_CLICK",e.TWO_STEP="TWO_STEP",e.SELF_HANDLED="SELF_HANDLED"}(e.TYPE||(e.TYPE={}))}(s||(s={})),t.OptInConfig=s;var l=function(){function e(){this.enabled=!1,this.websitePushId=null}return e}();t.SafariConfig=l;var f=function(){function e(){this.webPush=null}return e}(),d=function(){function e(){this.enabled=!1,this.domainType=e.DOMAIN_TYPE.NA,this.isServiceWorkerRoot=!0,this.serviceWorkerFilename="serviceworker.js",this.apiKey="",this.subscriptionMode="normal",this.vapidPublicKey=null}return e}();t.ChromeConfig=d,function(e){!function(e){e.NA="NA",e.HTTP="http",e.HTTPS="https",e.MUTLI="multi"}(e.DOMAIN_TYPE||(e.DOMAIN_TYPE={}))}(d||(d={})),t.ChromeConfig=d;var c=function(){function e(){this.safari=new l,this.chrome=new d,this.firefox=new d}return e}();t.PushPlatformSettings=c,t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(){function e(){}return e.set=function(t,n){e.baseLogTag;window&&(window.moeInternals?window.moeInternals.ephemeral?window.moeInternals.ephemeral[t]=n:(window.moeInternals.ephemeral={},window.moeInternals.ephemeral[t]=n):(window.moeInternals={},window.moeInternals.ephemeral={},window.moeInternals.ephemeral[t]=n))},e.get=function(e){return o.getProp(window,"moeInternals.ephemeral."+e,null)},e.baseLogTag="EphemeralStorage",e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),r=n(8),i=n(2),s=n(3),u=function(){function e(t){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://websdk.moengage.com/",this.inapp=null,this.customSoftAsk=null;var n=e.baseLogTag+".constructor";null!=a.getProp(t,"app_id",null)?(this.appId=a.getProp(t,"app_id",null),this.integrationType=l.OLD_SDK):null!=a.getProp(t,"appId",null)?(this.appId=a.getProp(t,"appId",null),this.integrationType=l.NEW_SDK):(i.default.error(1,n,"App Id not specified. Please check docs page to complete the integration - ",o.default.LINKS.WEBSDK_DOCS),this.integrationType=null),null!=a.getProp(t,"debug_logs",null)?this.debugLevel=a.getProp(t,"debug_logs",0):null!=a.getProp(t,"debugLevel",null)?this.debugLevel=a.getProp(t,"debugLevel",0):(i.default.log(2,n,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://websdk.moengage.com/",this.forceSwUpdate=a.getProp(t,"forceSwUpdate",!1),this.cluster=a.getProp(t,"cluster",null),this.cluster&&null!=o.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]&&(this.environment=o.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]),a.getProp(t,"environment",null)&&(this.environment=t.environment),this.environment&&(this.baseDomainName="https://"+this.environment+".moengage.com/"),this.debugLevel>0&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&this.appId.indexOf("_DEBUG")>=0&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=a.getProp(t,"swPath",null),null!=t.customSoftAsk?this.customSoftAsk={mainClass:a.getProp(t,"customSoftAsk.mainClass",null),allowClass:a.getProp(t,"customSoftAsk.allowClass",null),dismissClass:a.getProp(t,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:a.getProp(t,"main_class",null),allowClass:a.getProp(t,"allow_class",null),dismissClass:a.getProp(t,"block_class",null)},null!=a.getProp(t,"inapp.host",null)&&(this.inapp={host:a.getProp(t,"inapp.host",null)}),null!=a.getProp(t,"swScope",null)&&(this.swScope=a.getProp(t,"swScope",null)))}return e.save=function(t){r.default.set(o.default.EPHEMERAL_STORAGE.INIT_DATA,new e(t)),s.default.set(o.default.PERSISTENT_STORAGE.INIT_DATA,new e(t))},e.get=function(){return r.default.get(o.default.EPHEMERAL_STORAGE.INIT_DATA)},e.setSoftAskConfig=function(t){var n=e.get(),o={appId:n.appId,debugLevel:n.debugLevel,cluster:n.cluster,environment:n.environment,swPath:n.swPath,customSoftAsk:{mainClass:a.getProp(t,"main_class",a.getProp(t,"mainClass",null)),allowClass:a.getProp(t,"allow_class",a.getProp(t,"allowClass",null)),dismissClass:a.getProp(t,"block_class",a.getProp(t,"dismissClass",null))}};e.save(o)},e.baseLogTag="InitData",e}();t.default=u;var l;!function(e){e.OLD_SDK="OLD_SDK",e.NEW_SDK="NEW_SDK"}(l||(l={}))},function(e,t,n){var o=n(20),a=n(21),r=a;r.v1=o,r.v4=a,e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),r=function(){function e(){}return e.set=function(t,n,a){var r=e.baseTag+".set";if(null==n)e.remove(t);else{n="boolean"==typeof n?JSON.stringify({actualValue:n,MOE_DATA_TYPE:"boolean"}):"string"==typeof n?JSON.stringify({actualValue:n,MOE_DATA_TYPE:"string"}):JSON.stringify(n),o.default.log(3,r,"Setting ",t,":",n);var i="";null!=a&&(i=";expires="+a.toISOString()),document.cookie=t+"="+encodeURIComponent(n)+i+";domain="+e.getOrigin()+";path=/;"}},e.get=function(t){for(var n=e.baseTag+".get",r=t+"=",i=decodeURIComponent(document.cookie),s=i.split(";"),u=s.length-1;u>=0;u--){for(var l=s[u];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(r)){var f=l.substring(r.length,l.length);try{f=JSON.parse(f),"string"===a.getProp(f,"MOE_DATA_TYPE",null)?(f=a.getProp(f,"actualValue",null),f=f?String(f):null):"boolean"===a.getProp(f,"MOE_DATA_TYPE",null)&&(f=a.getProp(f,"actualValue",null))}catch(e){}return o.default.log(3,n,"Got ",t,":",f),f}}return null},e.remove=function(t){var n=e.baseTag+".remove";document.cookie=t+"=;domain="+e.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",o.default.log(3,n,"Removed ",t)},e.getOrigin=function(){var t=e.baseTag+".getOrigin",n=window.location.origin;return n=n.indexOf(".")!=n.lastIndexOf(".")?n.substring(n.indexOf(".")):"."+n.substring(n.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(o.default.warn(1,t,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),n=""),n},e.baseTag="CookieStorage",e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(3),r=function(){function e(){this.items=[]}return e.enqueue=function(t,n){var o=e.getLocalStorageQName(t),r=new e;a.default.get(o)&&(r=a.default.get(o)),r.items.push(n),r.items=r.items.slice(Math.max(r.items.length-25,0)),a.default.set(o,r)},e.dequeue=function(t){var n=e.getLocalStorageQName(t),o=a.default.get(n),r=null;return o&&o.items.length>0&&(r=o.items[0],o.items.splice(0,1),a.default.set(n,o)),r},e.isEmpty=function(t){var n=e.getLocalStorageQName(t);if(a.default.get(n)){if(a.default.get(n).items.length>0)return!1}return!0},e.purge=function(t){var n=e.getLocalStorageQName(t);e.isEmpty(t)||a.default.remove(n)},e.getLocalStorageQName=function(e){return o.default.PERSISTENT_STORAGE.Q.PREFIX+"_"+e},e}();t.default=r},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);e.exports=function(){return n(o),o}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},function(e,t){function n(e,t){var n=t||0,a=o;return[a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]]].join("")}for(var o=[],a=0;a<256;++a)o[a]=(a+256).toString(16).substr(1);e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.key=e,this.value=t}return e.equal=function(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.PROMPT="prompt",e.GRANTED="granted",e.DENIED="denied",e.DISMISSED="dismissed"}(t.PERMISSION_STATE||(t.PERMISSION_STATE={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(){function e(){}return e.get=function(t,n){return e.makeNetworkCall(e.METHODS.GET,t,n)},e.post=function(t,n){return e.makeNetworkCall(e.METHODS.POST,t,n)},e.makeNetworkCall=function(t,n,a){return void 0===a&&(a={}),new Promise(function(r,i){var s=JSON.stringify(o.getProp(a,"postData",null));n=e.constructFinalUrl(n,o.getProp(a,"queryParams",null));var u=new XMLHttpRequest;u.open(t,n,!0),e.addRequestHeaders(u,o.getProp(a,"headers",{})),u.onreadystatechange=function(){4===u.readyState&&200===u.status?r({status:u.status,responseText:u.responseText}):4===u.readyState&&200!==u.status&&i({code:u.status,reason:u.responseText})},u.send(s)})},e.addRequestHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e},e.constructFinalUrl=function(e,t){e+="?";for(var n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return e},e}();!function(e){!function(e){e.GET="GET",e.POST="POST"}(e.METHODS||(e.METHODS={}))}(a||(a={})),t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(10),r=function(){function e(e,t){this.channel=e,this.target=t}return e.prototype.sendMessage=function(e,t){var n=this;return new Promise(function(o,r){var i={id:a.v4(),channel:n.channel,topic:e,message:t};n.addToListener(i,o,r),n.target instanceof HTMLIFrameElement?n.target.contentWindow.postMessage(i,n.target.src):n.target.postMessage(i,"*")})},e.listenToChannel=function(e,t,n){window.addEventListener("message",function(o){if(o.data&&o.data.channel&&o.data.topic&&o.data.channel===e&&o.data.topic===t){var a=function(n){var a={id:o.data.id,channel:e,topic:t,message:n};o.source.postMessage(a,o.origin)};n(o.data,a)}})},e.prototype.addToListener=function(t,n,a){var r=this;e.pendingPromises[t.id]={resolve:n,reject:a},window.addEventListener("message",function(t){t.data&&o.getProp(t.data,"channel",null)===r.channel&&null!=e.pendingPromises[t.data.id]&&(e.pendingPromises[t.data.id].resolve(t.data),delete e.pendingPromises[t.data.id])})},e.pendingPromises={},e}();t.default=r},function(e,t,n){"use strict";var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=n(10),i=n(6),s=n(0),u=function(){function e(){var t=e.baseLogTag+".constructor",n=i.default.getSync(),o=n.getAttribute("id");o=o||void 0;var s=window.analytics,u=void 0,l=void 0;if(s){l=s._VERSIONS;try{u=s.user().anonymousId()}catch(e){a.default.error(1,t,"Error getting anonymous id from segment api",e)}}this.c=void 0,this.h="",this.identifiers=void 0,(o||u)&&(this.identifiers={moe_user_id:o,segment_id:u}),this.meta={bid:r.v4(),segmentSdkData:s?l:void 0}}return e.baseLogTag="ReportPostData",e}(),l=function(){function e(t,n,a){var r,i;e.baseLogTag;this.type=t,this.getParams=n,this.event=a,this.postData=new u;var l={},f={};try{for(var d=o(a.attributes),c=d.next();!c.done;c=d.next()){var S=c.value;if(S&&null!=S.key&&(this.status=e.STATUS.VALID,null!=S.value))if("function"==typeof S.value.getMonth){var E={};E[S.key]=Math.round(S.value.getTime()-6e4*S.value.getTimezoneOffset()),null==f.timestamp&&(f.timestamp=[]),f.timestamp.push(E)}else l[S.key]=S.value}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}this.postData.e=a.name,this.postData.a=l,this.postData.c=s.isObjectEmpty(f)?void 0:f,window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}return e.baseLogTag="ReportClass",e}();!function(e){!function(e){e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID"}(e.STATUS||(e.STATUS={}));!function(e){e[e.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",e[e.EVENT=1]="EVENT"}(e.REPORT_ADD_TYPE||(e.REPORT_ADD_TYPE={}))}(l||(l={})),t.default=l},function(e,t,n){function o(e,t,n){var o=t&&n||0,f=t||[];e=e||{};var d=e.node||a,c=void 0!==e.clockseq?e.clockseq:r;if(null==d||null==c){var S=i();null==d&&(d=a=[1|S[0],S[1],S[2],S[3],S[4],S[5]]),null==c&&(c=r=16383&(S[6]<<8|S[7]))}var E=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:l+1,T=E-u+(g-l)/1e4;if(T<0&&void 0===e.clockseq&&(c=c+1&16383),(T<0||E>u)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=E,l=g,r=c,E+=122192928e5;var p=(1e4*(268435455&E)+g)%4294967296;f[o++]=p>>>24&255,f[o++]=p>>>16&255,f[o++]=p>>>8&255,f[o++]=255&p;var _=E/4294967296*1e4&268435455;f[o++]=_>>>8&255,f[o++]=255&_,f[o++]=_>>>24&15|16,f[o++]=_>>>16&255,f[o++]=c>>>8|128,f[o++]=255&c;for(var h=0;h<6;++h)f[o+h]=d[h];return t||s(f)}var a,r,i=n(13),s=n(14),u=0,l=0;e.exports=o},function(e,t,n){function o(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;++s)t[o+s]=i[s];return t||r(i)}var a=n(13),r=n(14);e.exports=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),a=function(){function e(){}return e.isTokenValid=function(t,n){return new Promise(function(a,r){if(null!=t&&null!=n){var i="https://iid.googleapis.com/iid/info/"+t+"?details=true",s={headers:{authorization:"key="+n}};o.default.get(i,s).then(function(e){a(200===e.status?!0:!1)}).catch(function(o){0===o.code?setTimeout(function(){return e.isTokenValid(t,n)},3e3):a(!1)})}else a(!1)})},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(12),r=n(1),i=n(26),s=n(4),u=n(0),l=r.default.PERSISTENT_STORAGE.Q,f=function(){function e(){}return e.clear=function(t){for(var n=e.baseLogTag+".clear",r=[];!a.default.isEmpty(t);)!function(){switch(t){case l.REPORT:var e=a.default.dequeue(l.REPORT);r.push(function(t){s.default.reportAdd(e).then(function(){t()})});break;case l.DEVICE:a.default.dequeue(l.DEVICE)&&r.push(function(e){s.default.deviceAdd().then(function(){e()})});break;default:o.default.error(1,n,"Do not know how to handle queue with name:",t)}}();setTimeout(function(){e.processing[t]=!0,i(r,5,function(n,o){e.processing[t]=!1})},0)},e.startPeriodicClear=function(t){var n=e.baseLogTag+".startPeriodicCleanQ";e.clearInterval(t);var r=function(){a.default.isEmpty(t)?(o.default.log(1,n,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),u.getProp(e.processing,t,!1)||e.clearInterval(t)):(e.clear(t),o.default.log(1,n,"Starting periodic queue clear for",t))};r(),e.intervals[t]=setInterval(r,6e3)},e.clearInterval=function(t){null!=e.intervals[t]&&(clearInterval(e.intervals[t]),e.intervals[t]=null)},e.baseLogTag="QManager",e.intervals={},e.processing={},e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(22),r=n(18),i=n(3),s=n(16),u=n(9),l=function(){function e(e){var t=this;this.sdkSettings=e,this.getIframe(),r.default.listenToChannel(o.default.HTML_COMM.CHANNEL.SUBD,o.default.HTML_COMM.TOPICS.CONFIG,function(e,n){n(t.sdkSettings)})}return e.prototype.showHardAsk=function(){var t=this;e.baseLogTag;return new Promise(function(e,n){t.getIframeCommunicator().then(function(n){n.sendMessage(o.default.HTML_COMM.TOPICS.EPHEMERAL_STORAGE,{requestType:"set",key:o.default.EPHEMERAL_STORAGE.INIT_DATA,value:u.default.get()}).then(function(a){n.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:o.default.PERSISTENT_STORAGE.INIT_DATA,value:u.default.get()}).then(function(a){n.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then(function(a){null!=a.message?t.isTokenValid().then(function(r){if(r)e({state:s.PERMISSION_STATE.GRANTED,subscriptionDetails:a.message});else{var i=n.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}),u=t.removeToken();Promise.all([i,u]).then(function(){t.openNewTabForPermission(n).then(function(t){e(t)})})}}):t.openNewTabForPermission(n).then(function(t){e(t)})})})})})})},e.prototype.openNewTabForPermission=function(e){var t=this;return new Promise(function(n){e.sendMessage(o.default.HTML_COMM.TOPICS.CONFIG,t.sdkSettings).then(function(e){r.default.listenToChannel(o.default.HTML_COMM.CHANNEL.SUBD,o.default.HTML_COMM.TOPICS.HARD_ASK_RESULT,function(e,t){t("Ok");var o=e.message;n(o)}),window.open(t.sdkSettings.platformSettings.chrome.subdomainURL+"?startSubscription=true","_blank","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=400,height=400")})})},e.prototype.getCurrentPermissionState=function(){var e=this;return new Promise(function(t,n){e.getIframeCommunicator().then(function(e){e.sendMessage(o.default.HTML_COMM.TOPICS.PERMISSION_STATE,{requestType:"get"}).then(function(e){t(e.message)})})})},e.prototype.getPushTokenDetails=function(){var e=this;return new Promise(function(t){e.getOrSetInSubDomainStorage(o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS).then(function(e){t(e)})})},e.prototype.setInSubDomainStorage=function(e,t){var n=this;return new Promise(function(a){n.getIframeCommunicator().then(function(n){n.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:e,value:t}).then(function(e){a()})})})},e.prototype.logout=function(){var e=this;return new Promise(function(t){e.getIframeCommunicator().then(function(e){e.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"logout"}).then(function(e){t()})})})},e.prototype.getInSubdomain=function(t){var n=this;e.baseLogTag;return new Promise(function(e){n.getIframeCommunicator().then(function(n){n.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:t}).then(function(t){e(null==t.message?null:t.message)}).catch(function(t){e(null)})}).catch(function(t){e(null)})})},e.prototype.setInSubdomain=function(t,n){var a=this;e.baseLogTag;return new Promise(function(e,r){a.getIframeCommunicator().then(function(a){a.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:t,value:n}).then(function(t){e()}).catch(function(e){r(e)})}).catch(function(e){r(e)})})},e.prototype.getOrSetInSubDomainStorage=function(e,t){var n=this;return new Promise(function(o){n.getInSubdomain(e).then(function(a){null==a?n.setInSubdomain(e,t).then(function(){o(t)}).catch(function(e){o(t)}):o(a)})})},e.prototype.isTokenValid=function(){var e=this;return new Promise(function(t){e.getPushTokenDetails().then(function(n){n&&n.token?a.default.isTokenValid(n.token,e.sdkSettings.platformSettings.chrome.apiKey).then(function(n){n?t(n):e.getIframeCommunicator().then(function(e){e.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then(function(){e.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:o.default.PERSISTENT_STORAGE.HARD_ASK_STATUS}).then(function(){t(n)})})})}):t(!1)})})},e.prototype.removeToken=function(){var e=this;return new Promise(function(t){i.default.remove(o.default.PERSISTENT_STORAGE.PUSH_TOKEN),e.getIframeCommunicator().then(function(e){e.sendMessage(o.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:o.default.PERSISTENT_STORAGE.PUSH_TOKEN}).then(function(e){t()})})})},e.prototype.getIframeCommunicator=function(){var t=this;return new Promise(function(n){e.iframeCommunicator?n(e.iframeCommunicator):t.getIframe().then(function(t){e.iframeCommunicator=new r.default(o.default.HTML_COMM.CHANNEL.MAIN,t),n(e.iframeCommunicator)})})},e.prototype.getIframe=function(){var t=this;return new Promise(function(n,o){if(null==e.iframe){var a=document.createElement("iframe");a.id="moengage-subd-iframe",a.style.display="none",a.src=t.sdkSettings.platformSettings.chrome.subdomainURL,document.body.appendChild(a),e.iframe=a,a.addEventListener("load",function(){e.iframeLoaded=!0,n(a)})}else e.iframeLoaded?n(e.iframe):setTimeout(function(){t.getIframe().then(function(e){n(e)})},500)})},e.prototype.showNotification=function(e){var t=this;this.getIframeCommunicator().then(function(n){n.sendMessage(o.default.HTML_COMM.TOPICS.SHOW_NOTIF,{notification:e,config:t.sdkSettings})})},e.baseLogTag="ChromeHTTPNotificationManager",e.iframeLoaded=!1,e}();t.default=l},,function(e,t,n){(function(t){function n(e,n,o){function a(e){function n(){o&&o(e,i),o=null}d?t.nextTick(n):n()}function r(t,n,o){if(i[t]=o,n&&(f=!0),0==--u||n)a(n);else if(!f&&c<s){var d;l?(d=l[c],c+=1,e[d](function(e,t){r(d,e,t)})):(d=c,c+=1,e[d](function(e,t){r(d,e,t)}))}}if("number"!=typeof n)throw new Error("second argument must be a Number");var i,s,u,l,f,d=!0;Array.isArray(e)?(i=[],u=s=e.length):(l=Object.keys(e),i={},u=s=l.length);var c=n;u?l?l.some(function(t,o){if(e[t](function(e,n){r(t,e,n)}),o===n-1)return!0}):e.some(function(e,t){if(e(function(e,n){r(t,e,n)}),t===n-1)return!0}):a(null),d=!1}e.exports=n}).call(t,n(27))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function r(e){if(d===clearTimeout)return clearTimeout(e);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function i(){g&&S&&(g=!1,S.length?E=S.concat(E):T=-1,E.length&&s())}function s(){if(!g){var e=a(i);g=!0;for(var t=E.length;t;){for(S=E,E=[];++T<t;)S&&S[T].run();T=-1,t=E.length}S=null,g=!1,r(e)}}function u(e,t){this.fun=e,this.array=t}function l(){}var f,d,c=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(e){d=o}}();var S,E=[],g=!1,T=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];E.push(new u(e,t)),1!==E.length||g||a(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=l,c.addListener=l,c.once=l,c.off=l,c.removeListener=l,c.removeAllListeners=l,c.emit=l,c.prependListener=l,c.prependOnceListener=l,c.listeners=function(e){return[]},c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(4),r=n(15),i=n(29),s=n(19),u=n(34),l=function(){function e(){}return e.track=function(e,t,n){var l="MoEngage.event.trackEvent";return new Promise(function(f,d){if(n=!!n,"string"==typeof e&&e){var c=[];if(null==t||null!==t&&t===Object(t)&&"[object Object]"===Object.prototype.toString.call(t)){null==t&&(t={}),t.URL=location.href;for(var S in t)t.hasOwnProperty(S)&&c.push(new r.default(S,t[S]));var E=new i.default(e,c);u.default.addEvent(E),a.default.collectGetParams().then(function(e){var t=new s.default(s.default.REPORT_ADD_TYPE.EVENT,e,E);a.default.reportAdd(t,n).then(function(){f()})})}else o.default.error(1,l,"Event attributes were not passed a key-value pair object for event: ",e),f({error:5002,message:"Event value needs to be a key-value pair object"})}else o.default.log(1,l,"Event name not a string or null or empty string:",e),f({error:5001,message:"Event name can not be null"})})},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(15),a=n(1),r=n(6),i=n(2),s=function(){function e(e,t){this.name=e,this.attributes=t}return e.createUserAttributeEvent=function(t){return new Promise(function(n,s){var u=[],l=t.key;switch(t.key){case"id":t.key=a.default.ATTRIBUTE_NAMES.ID;break;case"email":t.key=a.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":t.key=a.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":t.key=a.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":t.key=a.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":t.key=a.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":t.key=a.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":t.key=a.default.ATTRIBUTE_NAMES.BDAY}u.push(t),r.default.get().then(function(r){var s=r.indexOfAttribute("oldUniqueIds");s>-1&&null!=r.attributes[s].value&&r.attributes[s].value.length>0&&u.push(new o.default(a.default.ATTRIBUTE_NAMES.ID_MODIFIED,r.attributes[s].value[r.attributes[s].value.length-1])),t.key!==l&&i.default.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",t.key),n(new e(a.default.EVENT_NAMES.USER_ATTRIBUTE,u))})})},e}();t.default=s},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(){function e(){}return e.getListeners=function(){return this.listeners},e.getTopicListeners=function(t){return o.getProp(e.topicListeners,t,[])},e.addListener=function(t){e.listeners.push(t)},e.addTopicListener=function(t,n){e.topicListeners[t]=e.getTopicListeners(t),e.topicListeners[t].push(n)},e.broadcast=function(t){e.listeners.map(function(e){e(t)}),o.getProp(e.topicListeners,t.topic,[]).map(function(e){e(t)})},e.broadcastToWindow=function(e){window&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data?e.data:null}}))},e.deprecatedSdkCallback=function(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))},e.resetAllListeners=function(){e.listeners=[],e.topicListeners={}},e.listeners=[],e.topicListeners={},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(2),r=n(3),i=n(7),s=n(5),u=n(6),l=n(4),f=n(45),d=n(16),c=n(46),S=n(28),E=n(11),g=n(0),T=n(40),p=function(){function e(t,n){this.notificationManager=null,this.softAskManager=null;e.baseLogTag;this.sdkSettings=t,this.browser=n,this.softAskManager=new c.default(this.sdkSettings),this.notificationManager=new f.default(this.sdkSettings,n)}return e.prototype.callWebPush=function(){var t=this,n=e.baseLogTag+".callWebPush";this.isWebPushEnabled()&&this.notificationManager.getCurrentPermissionState().then(function(e){var i=function(){u.default.get().then(function(i){var s=!1;null!=i.getAttribute("email")&&(s=!0),i.deviceAdded=s,i.save().then(function(){t.notificationManager.removeToken().then(function(){e===d.PERMISSION_STATE.DENIED?a.default.log(1,n,"Not asking for permission as current state is denied."):(r.default.remove(o.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME),t.startPushSubscription())})})})},l=r.default.get(o.default.PERSISTENT_STORAGE.PUSH_TOKEN);null==l&&e!==d.PERMISSION_STATE.DENIED?t.startPushSubscription():null!=l&&e===d.PERMISSION_STATE.DENIED?(a.default.log(1,n,"User has removed the permission"),a.default.image(1,o.default.GIFS.SAD),S.default.track(o.default.EVENT_NAMES.UNSUBSCRIBED,{Source:"Website"}).then(function(){i()})):e===d.PERMISSION_STATE.DENIED?a.default.warn(1,n,"Not proceeding with push subscription as current state is denied"):null!=l&&e===d.PERMISSION_STATE.GRANTED?t.browser.name===s.default.BROWSER_NAMES.CHROME?g.isVapid(t.sdkSettings.platformSettings,t.browser)?t.startPushSubscription():t.notificationManager.isTokenValid().then(function(e){e?(t.startPushSubscription(),a.default.log(1,n,"Push token is valid"),t.notificationManager.getPushTokenDetails().then(function(e){a.default.customLabel(1,n,"token",e.token)})):(a.default.warn(1,n,"Push token has expired. Trying to get a new token. This is a Chrome only feature."),i())}):(t.startPushSubscription(),t.notificationManager.getPushTokenDetails().then(function(e){a.default.customLabel(1,n,"token",e.token)})):t.sdkSettings.isDomainLevelStorage?"granted"===E.default.get(o.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)?a.default.log(1,n,"Not showing opt-in as user subscribed to sub-domain"):t.startPushSubscription():i()}).catch(function(e){a.default.error(1,n,"Error in getting current state:",e)})},e.prototype.startPushSubscription=function(){var t=this,n=e.baseLogTag+".startPushSubscription",s=function(){r.default.set(o.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,d.PERMISSION_STATE.PROMPT);var e=r.default.get(o.default.PERSISTENT_STORAGE.PUSH_TOKEN);t.notificationManager.showHardAsk().then(function(i){if(r.default.set(o.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,i.state),i.state===d.PERMISSION_STATE.GRANTED)if(null!=i.subscriptionDetails.token)r.default.set(o.default.PERSISTENT_STORAGE.PUSH_TOKEN,i.subscriptionDetails.token),r.default.set(o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,i.subscriptionDetails),i.subscriptionDetails.token&&e!==i.subscriptionDetails.token&&l.default.deviceAdd().then(function(){a.default.image(1,o.default.GIFS.AMAZED),u.default.getSync().subscribedToOldSdk?a.default.log(1,n,"User subscribed from older sdk, hence not sending subscription event"):(null!=e?T.default.addAttribute("Web Migrated User","true"):(T.default.addAttribute("Web Push Preference","granted"),T.default.addAttribute("Web Subscription URL",location.href)),S.default.track(o.default.EVENT_NAMES.USER_SUBSCRIBED,{MOE_WEB_PUSH_TOKEN:i.subscriptionDetails.token}),S.default.track(o.default.EVENT_NAMES.USER_SUBSCRIBED,{MOE_WEB_PUSH_TOKEN:i.subscriptionDetails.token},!0))}),t.sdkSettings.isDomainLevelStorage&&(E.default.set(o.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,i.subscriptionDetails),E.default.set(o.default.PERSISTENT_STORAGE.PUSH_TOKEN,i.subscriptionDetails.token));else{a.default.error(1,n,"Push token was received as null. This could be because of the following reasons:","\n1. Manifest not hosted\n2. Manifest not linked in HTML\n3. sender_id not present in manifest file."),a.default.error(1,n,"Please contact MoEngage support if this troubleshooting does not solve the issue.")}else i.state===d.PERMISSION_STATE.DENIED&&a.default.image(1,o.default.GIFS.SAD)}).catch(function(e){a.default.warn(1,n,e)})};this.notificationManager.getCurrentPermissionState().then(function(e){if(e===d.PERMISSION_STATE.GRANTED)t.sdkSettings.optInConfig.type!==i.OptInConfig.TYPE.ONE_CLICK&&a.default.log(1,n,"Skipping soft ask as browser permission is set to allow all notifications"),s();else{var u=parseInt(r.default.get(o.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME)),l=r.default.get(o.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),f=r.default.get(o.default.PERSISTENT_STORAGE.HARD_ASK_STATUS),S=Date.now(),E=(S-u)/36e5;if(!u||l===c.SoftAskState.SHOWN||l===c.SoftAskState.ALLOWED||f===d.PERMISSION_STATE.PROMPT||E>t.sdkSettings.optInConfig.reappearTime)t.softAskManager?t.softAskManager.showSoftAsk().then(function(e){e.showHardAsk&&s()}):a.default.log(1,n,"SoftAskManager not set.");else{var g=void 0,T=void 0;E<1?(g=Math.floor(60*E),T="minute(s)"):(g=Math.floor(100*E)/100,T="hour(s)"),a.default.log(1,n,"Not showing opt in as last it was shown",g,T,"back on",new Date(u),". Reappear time is set to",t.sdkSettings.optInConfig.reappearTime,"hours."),a.default.log(1,n,"You can clear localstorage to get opt-in again.")}}})},e.prototype.isWebPushEnabled=function(){return i.default.isFeatureEnabled(this.sdkSettings,o.default.SDK_FEATURES.WEB_PUSH)&&!this.browser.isIncognito&&e.SUPPORTED_BROWSERS.indexOf(this.browser.name)>=0},e.prototype.getPermissionState=function(){return this.notificationManager.getCurrentPermissionState()},e.prototype.showNotification=function(e){this.notificationManager&&this.notificationManager.showNotification(e)},e.baseLogTag="WebPushManager",e.SUPPORTED_BROWSERS=[s.default.BROWSER_NAMES.CHROME,s.default.BROWSER_NAMES.FIREFOX,s.default.BROWSER_NAMES.OPERA],e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.addEvent=function(t){e.history.push(t),e.listeners.forEach(function(e){e(t)})},e.getHistory=function(){return e.history},e.addEventListener=function(t){e.listeners.push(t)},e.clear=function(){e.history=[]},e.history=[],e.listeners=[],e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=n(1),r=n(2),i=n(5),s=n(7),u=n(3),l=n(16),f=n(9),d=n(4),c=n(0),S=function(){function e(t){var n=this;this.swRegisterPromise=null;var o=e.baseLogTag+".constructor";this.sdkSettings=t,this.registerServiceWorker().then(function(e){n.sendDataToServiceWorker()}).catch(function(e){r.default.error(1,o,"Error registering serviceworker:",e)})}return e.prototype.showHardAsk=function(){var t=this,n=e.baseLogTag+".showHardAsk";return new Promise(function(o,i){e.isWebPushSupported().then(function(e){e?t.getCurrentPermissionState().then(function(e){t.registerServiceWorker().then(function(s){e!==l.PERMISSION_STATE.DENIED?(r.default.log(1,n,"Attempting to open hard ask"),t.showOverlay(),t.askPermission().then(function(e){t.hideOverlay(),r.default.log(2,n,"Permission state after hard ask:",e),e===l.PERMISSION_STATE.GRANTED?t.getPushTokenDetails().then(function(n){t.sendDataToServiceWorker(n.token),o({state:e,subscriptionDetails:n})}):(t.sendDataToServiceWorker(),o({state:e,subscriptionDetails:null}))}).catch(function(e){r.default.error(1,n,e),i(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):(r.default.log(1,n,"Hard ask not shown as permission state is",e),o({state:e,subscriptionDetails:null}))}).catch(function(e){r.default.error(1,n,"Error registering serviceworker:",e),i(e)})}).catch(function(e){r.default.error(1,n,"Registering service worker failed:",e),i(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}):(r.default.warn(1,n,"Web push not supported in current browser environment"),i(a.default.ERRORS.WEB_PUSH_NOT_SUPPORTED))})})},e.prototype.sendDataToServiceWorker=function(e){return new Promise(function(t){d.default.collectGetParams().then(function(t){e&&(t.push_id=e||u.default.get(a.default.PERSISTENT_STORAGE.PUSH_TOKEN)||void 0),navigator.serviceWorker.ready.then(function(){navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({data:t})})})})},e.prototype.getCurrentPermissionState=function(){return navigator.permissions?navigator.permissions.query({name:"notifications"}).then(function(t){return e.parsePermissionState(t.state)}).catch(function(e){}):new Promise(function(t){t(e.parsePermissionState(Notification.permission))})},e.prototype.getPushTokenDetails=function(){var t=this;e.baseLogTag;return new Promise(function(e,n){t.getCurrentPermissionState().then(function(n){n!==l.PERMISSION_STATE.GRANTED?e({token:null,raw:null}):i.default.getInstance().then(function(n){t.registerServiceWorker().then(function(o){var a=null,r={userVisibleOnly:!0};c.isVapid(t.sdkSettings.platformSettings,n)&&(a=c.getVapidPublicKey(t.sdkSettings.platformSettings,n),r.applicationServerKey=c.stringToBuffer(a));var i=function(t){var n=t.toJSON(),o=t.endpoint.substring(0,n.endpoint.lastIndexOf("/")+1),a=n.expirationTime,r=n.endpoint.split("/")[n.endpoint.split("/").length-1],i={};if(n.keys)for(var s in n.keys)n.keys.hasOwnProperty(s)&&(i[s]=n.keys[s]);e({token:r,endpoint:o,keys:i,expirationTime:a,raw:n})},s=function(){o.pushManager.subscribe(r).then(function(e){i(e)}).catch(function(t){e({token:null,raw:null})})};o.pushManager.getSubscription().then(function(e){if(e)if("vapid"===t.sdkSettings.platformSettings.chrome.subscriptionMode&&e.options&&e.options.applicationServerKey){var n=c.bufferToString(e.options.applicationServerKey),o=[a,a+"=",a+"==",c.bufferToString(c.stringToBuffer(a))];o.indexOf(n)<0?e.unsubscribe().then(function(){s()}):s()}else s();else s()})}).catch(function(t){e({token:null,raw:null})})})})})},e.prototype.isTokenValid=function(){var e=this;return this.getPushTokenDetails().then(function(t){return o.default.isTokenValid(t.token,e.sdkSettings.platformSettings.chrome.apiKey)})},e.prototype.removeToken=function(){return u.default.remove(a.default.PERSISTENT_STORAGE.PUSH_TOKEN),Promise.resolve()},e.prototype.askPermission=function(){return new Promise(function(t,n){Notification.requestPermission().then(function(n){t(e.parsePermissionState(n))}).catch(function(e){n(a.default.ERRORS.PERMISSION_DISMISSED_TOO_MANY_TIMES)})})},e.prototype.registerServiceWorker=function(){var t=this,n=e.baseLogTag+".registerServiceWorker";return null!=this.swRegisterPromise?this.swRegisterPromise:(this.swRegisterPromise=new Promise(function(o,i){if(e.registeredServiceWorker)o(e.registeredServiceWorker);else if("serviceWorker"in navigator){var u=void 0,l=!1;f.default.get()&&null!=f.default.get().swPath?(u=f.default.get().swPath,l=!0):(u=t.sdkSettings.platformSettings.chrome.serviceWorkerFilename,l=!1);var d="/";if(f.default.get()&&null!=f.default.get().swScope)d=f.default.get().swScope;else if(t.sdkSettings.platformSettings.chrome.isServiceWorkerRoot)l&&(r.default.log(1,n,"Using user defined path to serviceworker:",u),d=u.substr(0,u.lastIndexOf("/")+1),e.canSwBeRegisteredWithScope(d)||(r.default.error(1,n,"Service worker can only be registered from same directory or child directory."),i(a.default.ERRORS.SERVICE_WORKER_NOT_IN_CORRECT_SCOPE)));else{var c=window.location.pathname;d=c.substring(0,c.lastIndexOf("/")+1)}"/"!=u[0]&&(u="/"+u),r.default.log(1,n,"Scope for serviceworker:",d),s.default.isFeatureEnabled(t.sdkSettings,a.default.SDK_FEATURES.WEB_PUSH)?navigator.serviceWorker.register(u,{scope:d}).then(function(t){r.default.log(2,n,"Serviceworker registered"),navigator.serviceWorker.ready.then(function(t){r.default.log(2,n,"Serviceworker ready"),e.registeredServiceWorker=t,f.default.get()&&f.default.get().forceSwUpdate&&t.update(),o(t)}).catch(function(e){r.default.error(1,n,"Service worker register failed:",e),i(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})}).catch(function(e){r.default.error(1,n,"Service worker register failed:",e),i(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}):r.default.log(1,n,"Not registering serviceworker as web push is not enabled in current environment")}else r.default.error(1,n,"Service worker not supported"),i("Service worker not supported")}),this.swRegisterPromise)},e.canSwBeRegisteredWithScope=function(e){var t=window.location.pathname;return function(e,t){return!(t.indexOf(e)<0)&&t.substring(t.indexOf(e)).length>=0}(e,t)},e.isWebPushSupported=function(){return new Promise(function(e){i.default.getInstance().then(function(t){e(t.isIncognito?!1:"serviceWorker"in navigator&&"PushManager"in window&&t.isChromeLike()?!0:!1)})})},e.parsePermissionState=function(e){return"prompt"===e?l.PERMISSION_STATE.PROMPT:"granted"===e?l.PERMISSION_STATE.GRANTED:"denied"===e?l.PERMISSION_STATE.DENIED:"default"===e?l.PERMISSION_STATE.DISMISSED:null},e.prototype.showNotification=function(t){var n=e.baseLogTag+".showNotification";this.registerServiceWorker().then(function(e){t?t.title?t.body?(null==t.requireInteraction&&(t.requireInteraction=!0),e.showNotification(t.title,t)):r.default.error(1,n,"Notification body can not be blank"):r.default.error(1,n,"Notification title can not be blank"):r.default.error(1,n,"Notification object can not be blank")}).catch(function(e){r.default.error(1,n,"Error registering serviceworker:",e)})},e.prototype.showOverlay=function(){var e=this;if(this.sdkSettings.optInConfig.showOverlay){var t=document.createElement("div");t.id="moe-push-div",t.className="moe-push-class",i.default.getInstance().then(function(n){n.isMobile?t.innerHTML=e.sdkSettings.optInConfig.softAskConfig.mobile.customHTML:t.innerHTML=e.sdkSettings.optInConfig.softAskConfig.desktop.customHTML;var o=document.body.firstChild;o.parentNode.insertBefore(t,o);var a,r=n.name;if(r===i.default.BROWSER_NAMES.CHROME||r===i.default.BROWSER_NAMES.OPERA_NEON?a=document.getElementsByClassName("moe_chrome"):r===i.default.BROWSER_NAMES.FIREFOX?a=document.getElementsByClassName("moe_firefox"):r===i.default.BROWSER_NAMES.OPERA?a=document.getElementsByClassName("moe_opera"):r===i.default.BROWSER_NAMES.SAFARI&&(a=document.getElementsByClassName("moe_opera")),0==a.length)document.getElementById("moe-push-div").style.display="none";else for(var s=a.length-1;s>=0;s--)a[s].style.display="block";t.onclick=function(){e.hideOverlay()}})}},e.prototype.hideOverlay=function(){var e=document.getElementById("moe-push-div");null!=e&&(e.style.visibility="none",e.style.opacity="0",e.parentNode.removeChild(e))},e.baseLogTag="HTTPS-NotificationManager",e}();t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.addCallback=function(t,n){null!=t&&null!=n&&(null==e.callbacks[t]&&(e.callbacks[t]=[]),e.callbacks[t].push(n))},e.getCallbacks=function(t){return e.callbacks[t]||[]},e.runCallbacks=function(t){e.getCallbacks(t).forEach(function(e){e()})},e.callbacks={},e}();t.default=o},,function(e,t,n){"use strict";function o(e){var n="Pre-Initialization";if(u.default.log(1,n,"Init data: ",e),"undefined"==typeof Promise)return u.default.error(1,n,"Promises not supported"),d.DummyMoengageObject;if(e.app_id||e.appId){T.default.save(e),A().then(function(){l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.MOE_INIT,data:T.default.get()}),u.default.setLogLevel(T.default.get().debugLevel),u.default.log(1,n,"Script loaded!"),u.default.customLabel(1,n,"SDK Version","0.80.0"),T.default.get().debugLevel>0&&(u.default.warn(1,n,"You are currently using MoEngage in debug environment. You'll find all the data captured in this environment in the TEST mode on the dashoard."),u.default.warn(1,n,"Please initialize with debugLevel as",0,"when using on your production environment.")),t.initializeLaunchSequence()});var o=window.moengage_object||"Moengage";return window[o]=d.default,d.default}return u.default.error(1,n,"App Id not specified. Please check docs page to complete the integration - ",i.default.LINKS.WEBSDK_DOCS),d.DummyMoengageObject}var a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,a,r=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(e){a={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return i},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),s=n(23),u=n(2),l=n(32),f=n(4),d=n(39),c=n(3),S=n(5),E=n(6),g=n(7),T=n(9),p=n(33),_=n(16),h=n(41),m=n(34),A=function(){return new Promise(function(e){"complete"!=window.document.readyState?window.addEventListener("load",function(){e()}):e()})};window&&(window.moe=o,window.moeBannerText="banner",window[i.WINDOW_OBJECTS.PageEventHistroyManager]=m.default),t.initializeLaunchSequence=function(){var e="Initialization";return new Promise(function(t){f.default.getWebSDKSettings().then(function(n){n.isDomainLevelStorage&&(c.default.isSharedWithCookie=!0,c.default.copyKeysFromCookie()),E.default.get().then(function(o){if(h.default.get().deviceToLogout===o.deviceUuid)return u.default.log(1,e,"User was not able to logout last time. Completing the logout now and starting new session."),d.default.user.logout();o.deviceAdded&&f.default.onDeviceAdd.res(),n.isPushSubBilling&&u.default.warn(1,e,"You are under push subscriber based billing plan. We are only tracking users with an email or have subscribed to web push. All user attributes and events will be stored in a queue till we receive either of the properties."),u.default.customLabel(1,e,"Device UUID",o.deviceUuid),u.default.customLabel(1,e,"Device Added",o.deviceAdded),l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.SETTINGS_FETCHED,data:n}),n.isPushSubBilling||o.deviceAdded||f.default.deviceAdd(),d.default.event.track(i.default.EVENT_NAMES.WEB_SESSION_START,{timestamp:Number(Date.now())}),d.default.event.track(i.default.EVENT_NAMES.PAGE_VIEWED,{timestamp:Number(Date.now())}),s.default.clear(i.default.PERSISTENT_STORAGE.Q.DEVICE),s.default.clear(i.default.PERSISTENT_STORAGE.Q.REPORT),S.default.getInstance().then(function(t){var o=new p.default(n,t);if(o.isWebPushEnabled()){if(!t.isIncognito){var a=[g.OptInConfig.TYPE.ONE_CLICK,g.OptInConfig.TYPE.TWO_STEP];if(a.indexOf(n.optInConfig.type)>=0)o.callWebPush();else{var r=c.default.get(i.default.PERSISTENT_STORAGE.PUSH_TOKEN);null==r?(u.default.log(1,e,"Self handled setting. Will show opt-in on manual invocation, if required."),o.getPermissionState().then(function(t){t===_.PERMISSION_STATE.GRANTED&&(u.default.log(1,e,"Notification permission already granted. Proceeding to subscribe the user"),o.callWebPush())}).catch(function(t){u.default.warn(1,e,"Cannot get permission state: ",t)})):o.callWebPush()}}}else t.isIncognito?u.default.warn(1,e,"Web push not supported in incognito mode"):p.default.SUPPORTED_BROWSERS.indexOf(t.name)<0?u.default.warn(1,e,"Web push not supported on this browser. Supported browsers are:\n\t\t1. Google Chrome\n\t\t2. Mozilla Firefox\n\t\t3. Opera"):u.default.warn(1,e,"Web push feature not enabled for current environment");n.inappEnabled&&f.default.onDeviceAdd.p.then(function(){d.enableOnsiteApi(n)}),O()}),t()})})})};var O=function(){var e="Moengage.clearWindowQ";A().then(function(){var t,n;try{var o=window.moengage_object||"Moengage";if(window[o]&&window.moengage_q){var a=window.moengage_q;if(window.moengage_q=[],a&&a.length>0&&window[o])for(var i=0;i<a.length;i++){u.default.log(1,e,"Method called before SDK downloaded:",[a[i].f],a[i].a);var s=a[i].f;"onsite.getData"===s?(t=d.default.onsite).getData.apply(t,r(a[i].a)):"onsite.registerCallback"===s?(n=d.default.onsite).registerCallback.apply(n,r(a[i].a)):null!=d.default[a[i].f]&&d.default[a[i].f].apply(null,a[i].a)}a=[]}}catch(t){u.default.error(1,e,t)}})}},function(e,t,n){"use strict";function o(e){O.default.loadModule(s.SDK_MODULES.INAPP).then(function(e){I.res(e),e.initialize(),v.onsite=e}).catch(function(e){I.rej(e)})}function a(e){return r(this,void 0,void 0,function(){var t,n,o;return i(this,function(a){switch(a.label){case 0:t="Moengage.disableOnsiteApi",a.label=1;case 1:return a.trys.push([1,5,,6]),e.inappEnabled?[4,O.default.loadModule(s.SDK_MODULES.INAPP)]:[3,4];case 2:return n=a.sent(),[4,n.logout()];case 3:a.sent(),I=new A.PromiseObject,v.onsite=P,a.label=4;case 4:return[3,6];case 5:return o=a.sent(),u.default.error(1,t,"Error logging out from inapp module:",o),[3,6];case 6:return[2]}})})}var r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(a,r){function i(e){try{u(o.next(e))}catch(e){r(e)}}function s(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){u.label=n[1];break}if(6===n[0]&&u.label<i[1]){u.label=i[1],i=n;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(n);break}i[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],r=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,i,s,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),u=n(2),l=n(3),f=n(4),d=n(5),c=n(7),S=n(44),E=n(40),g=n(28),T=n(4),p=n(33),_=n(36),h=n(6),m=n(9),A=n(0),O=n(47),I=new A.PromiseObject,P={getData:function(e,t){var n="MoEngage.onsite.getData";T.default.getWebSDKSettings().then(function(o){o.inappEnabled?I.p.then(function(n){n.getData(e,t)}).catch(function(e){u.default.error(1,n,"Error adding onsite module"),u.default.error(1,n,e)}):(u.default.log(1,n,"Onsite service not yet enabled for this app"),t({message:"Onsite service not enabled on MoEngage dashboard"},null))})},registerCallback:function(e,t){var n="MoEngage.onsite.registerCallback";T.default.getWebSDKSettings().then(function(o){o.inappEnabled?I.p.then(function(n){n.registerCallback(e,t)}).catch(function(e){u.default.error(1,n,"Error adding onsite module"),u.default.error(1,n,e)}):(u.default.log(1,n,"Onsite service not yet enabled for this app"),t({message:"Onsite service not enabled on MoEngage dashboard"},null))})}},v=function(){function e(){}return e.callWebPush=function(e){var t="MoEngage.callWebPush";f.default.getWebSDKSettings().then(function(n){if(n.isConfigured)if(c.default.isFeatureEnabled(n,s.default.SDK_FEATURES.WEB_PUSH))if(n.optInConfig.type===c.OptInConfig.TYPE.SELF_HANDLED){if(u.default.log(1,t,"Starting web push functions"),null!=e){m.default.setSoftAskConfig(e);var o=A.getProp(e,"soft_ask_display_callback",null),a=A.getProp(e,"soft_ask_allow_callback",null),r=A.getProp(e,"soft_ask_block_callback",null),i=A.getProp(e,"hard_ask_allow_callback",null),l=A.getProp(e,"hard_ask_dismiss_callback",null),f=A.getProp(e,"hard_ask_block_callback",null),S=s.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES;_.default.addCallback(S.SOFT_ASK_SHOWN,o),_.default.addCallback(S.SOFT_ASK_ALLOWED,a),_.default.addCallback(S.SOFT_ASK_DISMISSED,r),_.default.addCallback(S.HARD_ASK_ALLOWED,i),_.default.addCallback(S.HARD_ASK_DISMISSED,l),_.default.addCallback(S.HARD_ASK_DENIED,f)}d.default.getInstance().then(function(e){new p.default(n,e).callWebPush()})}else u.default.warn(1,t,"This feature can only be used when you have chosed self-handled approach in the dashboard. You can check dashboard here:","https://app.moengage.com/v3/#/settings/4/0");else u.default.warn(1,t,"Web push feature not enabled for current environment.");else u.default.log(1,t,"Web push settings not configured on dashboard yet. To start web push subscriptions, please configure the settings on dashboard.")})},e.showNotification=function(e){T.default.getWebSDKSettings().then(function(t){d.default.getInstance().then(function(n){new p.default(t,n).showNotification(e)})})},e.getSdkVersion=function(){return"0.80.0"},e.setDebugLevel=function(e){return r(this,void 0,void 0,function(){var t,n,o,a,r;return i(this,function(i){switch(i.label){case 0:t="MoEngage.setDebugLevel",i.label=1;case 1:return i.trys.push([1,7,,8]),[4,T.default.getWebSDKSettings()];case 2:if(n=i.sent(),!n.inappEnabled)return[3,6];i.label=3;case 3:return i.trys.push([3,5,,6]),[4,I.p];case 4:return o=i.sent(),o.setLogLevel(e),[3,6];case 5:return a=i.sent(),u.default.error(1,t,"Error setting debug level in inapp module",a),[3,6];case 6:return"number"==typeof e&&u.default.setLogLevel(e,!0),[3,8];case 7:return r=i.sent(),u.default.error(0,t,"Error changing log level:",r),[3,8];case 8:return[2]}})})},e.vitals=function(){var e=h.default.getSync();return{deviceUuid:e.deviceUuid,userDetails:e,pushToken:l.default.get(s.default.PERSISTENT_STORAGE.PUSH_TOKEN),softAskStatus:l.default.get(s.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),hardAskStatus:l.default.get(s.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)}},e.help=function(){u.default.log(0,"MoEngage.help","Moengage Dashboard - ",s.default.LINKS.MOE_DASHBOARD);for(var e in s.default.LINKS)s.default.LINKS.hasOwnProperty(e)&&u.default.log(0,"MoEngage.help",e,"-",s.default.LINKS[e])},e.track_event=function(e,t){return g.default.track(e,t)},e.add_unique_user_id=function(e){return E.default.login(e)},e.update_unique_user_id=function(e){return E.default.updateUniqueId(e)},e.add_user_attribute=function(e,t){return E.default.addAttribute(e,t)},e.add_first_name=function(e){return E.default.addAttribute("first_name",e)},e.add_last_name=function(e){return E.default.addAttribute("last_name",e)},e.add_email=function(e){return E.default.addAttribute("email",e)},e.add_mobile=function(e){return E.default.addAttribute("mobile",e)},e.add_user_name=function(e){return E.default.addAttribute("name",e)},e.add_gender=function(e){return E.default.addAttribute("gender",e)},e.add_birthday=function(e){return E.default.addAttribute("birthday",e)},e.destroy_session=function(){return e.user.logout()},e.call_web_push=function(t){e.callWebPush(t)},e.user=E.default,e.event=g.default,e.device=S.default,e.onsite=P,e}();t.default=v;var b=function(){};t.DummyMoengageObject={track_event:b,add_user_attribute:b,add_first_name:b,add_last_name:b,add_email:b,add_mobile:b,add_user_name:b,add_gender:b,add_birthday:b,destroy_session:b,add_unique_user_id:b,moe_events:b,location_type_attribute:b,call_web_push:b},t.enableOnsiteApi=o,t.disableOnsiteApi=a},function(e,t,n){"use strict";function o(){var e=_.default.get();null!=g.default.getSync()&&(e.deviceToLogout=g.default.getSync().deviceUuid,e.save())}function a(){l.default.remove(s.default.PERSISTENT_STORAGE.GRACEFUL_DATA)}var r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(a,r){function i(e){try{u(o.next(e))}catch(e){r(e)}}function s(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){u.label=n[1];break}if(6===n[0]&&u.label<i[1]){u.label=i[1],i=n;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(n);break}i[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],r=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,i,s,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),u=n(2),l=n(3),f=n(38),d=n(4),c=n(15),S=n(29),E=n(19),g=n(6),T=n(11),p=n(28),_=n(41),h=n(34),m=n(39),A=function(){function e(){}return e.addAttribute=function(t,n){var o="MoEngage.user.addUserAttribute";return new Promise(function(a,r){if("string"!=typeof t||null==t)u.default.error(1,o,"Attribute name needs to be a string"),a({error:5e3,message:"Attribute name needs to be a string. Type provided was "+typeof t});else if(""===t)u.default.error(1,o,"Attribute name can not be an empty string"),a({error:5001,message:"Attribute name can not be an empty string"});else if(null==n)u.default.error(1,o,"Attribute value null"),a({error:5003,message:"Attribute value was empty"});else if("string"==typeof n&&""===n)a({error:5004,message:"Attribute value needs to be non-empty string or a date object"});else if("object"==typeof n&&"function"!=typeof n.getMonth)a({error:5005,message:"Attribute value needs to be non-empty string or a date object"});else{var i=new c.default(t,n),s=function(){g.default.get().then(function(e){e.addAttribute(i).then(function(e){e?("id"===i.key&&u.default.log(1,o,"Logging in the user with id: ",i.value),S.default.createUserAttributeEvent(i).then(function(e){u.default.log(2,o,"Event to be converted to report:",e),h.default.addEvent(e),d.default.collectGetParams().then(function(t){var n=new E.default(E.default.REPORT_ADD_TYPE.USER_ATTRIBUTE,t,e);d.default.reportAdd(n).then(function(){a()})})})):(u.default.log(1,o,"Attribute already present/queued. Not adding again."),a({error:5005,message:"Attribute already present/queued. Not adding again."}))})})};"id"===t?g.default.get().then(function(t){var r=t.indexOfAttribute("id");r>-1?n===t.attributes[r].value?(u.default.log(1,o,"User already logged in with id:",n),a()):(u.default.log(1,o,"Logging out previous user with id:",t.attributes[r].value),e.logout(!0).then(function(){s()})):s()}):s()}})},e.login=function(t){return e.addAttribute("id",t)},e.logout=function(e){var t=this,n=e?{type:"forced"}:null;return o(),new Promise(function(e){p.default.track(s.default.EVENT_NAMES.LOGOUT,n).then(function(){u.default.log(1,"MoEngage.user.logout","Logging out now!"),d.default.getWebSDKSettings().then(function(n){return r(t,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return n.isDomainLevelStorage&&T.default.remove(s.default.PERSISTENT_STORAGE.USER_DATA),h.default.clear(),[4,m.disableOnsiteApi(n)];case 1:return t.sent(),l.default.logout(),[4,g.default.logout()];case 2:return t.sent(),a(),[4,f.initializeLaunchSequence()];case 3:return t.sent(),e(),[2]}})})})})})},e.updateUniqueId=function(t){var n="MoEngage.user.updateUniqueId";return new Promise(function(o){g.default.get().then(function(a){var r=a.indexOfAttribute(s.default.ATTRIBUTE_NAMES.ID),i=a.indexOfAttribute("oldUniqueIds");if(!(r>-1))return u.default.log(2,n,"Logging in as no id found"),e.login(t);var l=a.attributes[r].value;t!==l?(u.default.log(2,n,"Different ids found"),i>-1?(a.attributes[i].value.push(l),a.attributes.splice(r,1)):(a.attributes.splice(r,1),a.addAttribute(new c.default("oldUniqueIds",[l]))),a.save().then(function(){e.login(t).then(function(){o()})})):(u.default.warn(1,n,"New id and old id are the same. Not updating the id."),o())})})},e.getAttributes=function(){var e=g.default.getSync().attributes,t={};return e.map(function(e){t[e.key]=e.value}),t},e}();t.default=A},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),r=n(0),i=function(){function e(e){this.deviceToLogout=r.getProp(e,"deviceToLogout",null)}return e.get=function(){return new e(o.default.get(a.default.PERSISTENT_STORAGE.GRACEFUL_DATA))},e.prototype.save=function(){o.default.set(a.default.PERSISTENT_STORAGE.GRACEFUL_DATA,this)},e}();t.default=i},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(5),r=n(3),i=n(4),s=n(33),u=function(){function e(){}return e.getUuid=function(){return r.default.get(o.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid},e.getPushToken=function(){return r.default.get(o.default.PERSISTENT_STORAGE.PUSH_TOKEN)},e.getPermissionState=function(e){return new Promise(function(t,n){i.default.getWebSDKSettings().then(function(o){a.default.getInstance().then(function(a){new s.default(o,a).getPermissionState().then(function(n){t(n),e&&e(null,n)}).catch(function(t){n(t),e&&e(t,null)})})})})},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(2),r=n(0),i=n(32),s=n(5),u=n(7),l=n(3),f=n(28),d=n(24),c=n(35),S=n(16),E=n(36),g="Web push settings not configured on MoEngage dashboard: "+o.default.LINKS.MOE_DASHBOARD,T=function(){function e(t,n){this.currentManager=null;var i=e.baseLogTag+".constructor";this.config=t,this.browser=n,n.isIncognito?(this.currentManager=null,a.default.warn(1,i,"Web push not supported in incognito mode")):this.browser.isChromeLike()&&t.platformSettings.chrome?(t.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTPS?"http"===r.getCurrentProtocol()?a.default.error(1,i,"Domain configured as a HTTPS site and this is a HTTP site. Please update correct settings at",o.default.LINKS.MOE_DASHBOARD):this.currentManager=new c.default(t):t.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTP?this.currentManager=new d.default(t):t.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.MUTLI&&("https"===r.getCurrentProtocol()?this.currentManager=new c.default(t):this.currentManager=new d.default(t)),!1===t.platformSettings.chrome.enabled&&a.default.warn(1,i,"Web push settings not configured. Please configure at ",o.default.LINKS.MOE_DASHBOARD)):this.browser.name===s.default.BROWSER_NAMES.SAFARI&&t.platformSettings.safari&&"safari"in window&&"pushNotification"in window.safari&&(this.currentManager=null,a.default.warn(1,i,"Web push support for Safari will be coming soon. Please try on Chrome, Opera or Firefox."))}return e.prototype.showHardAsk=function(){var t=this,n=e.baseLogTag+".showHardAsk";return new Promise(function(e,r){t.getCurrentPermissionState().then(function(s){null!=t.currentManager?s===S.PERMISSION_STATE.PROMPT?(l.default.set(o.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),f.default.track(o.default.EVENT_NAMES.OPT_IN_SHOWN),i.default.broadcastToWindow({topic:o.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN}),i.default.deprecatedSdkCallback("opt_in_shown"),E.default.runCallbacks(o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN),t.currentManager.showHardAsk().then(function(t){t.state===S.PERMISSION_STATE.DISMISSED?(f.default.track(o.default.EVENT_NAMES.OPT_IN_DISMISSED),i.default.broadcastToWindow({topic:o.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED}),i.default.deprecatedSdkCallback("opt_in_dismissed"),E.default.runCallbacks(o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED),a.default.log(1,n,"Hard ask was dismissed")):t.state===S.PERMISSION_STATE.GRANTED?(f.default.track(o.default.EVENT_NAMES.OPT_IN_ALLOWED),i.default.broadcastToWindow({topic:o.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED,data:t.subscriptionDetails}),i.default.deprecatedSdkCallback("opt_in_allowed"),E.default.runCallbacks(o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED),a.default.log(1,n,"Push permission was granted"),a.default.customLabel(1,n,"token",t.subscriptionDetails.token)):t.state===S.PERMISSION_STATE.DENIED&&(f.default.track(o.default.EVENT_NAMES.OPT_IN_BLOCKED),f.default.track("Web Push Opt-in Denied"),i.default.broadcastToWindow({topic:o.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED}),i.default.deprecatedSdkCallback("opt_in_blocked"),E.default.runCallbacks(o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED),a.default.log(1,n,"Notification permission was denied")),e(t)}).catch(function(t){a.default.error(1,n,"Error showing hard ask:",t),e({state:s,subscriptionDetails:null})})):(a.default.log(1,n,"Not showing Hard Ask as current permission state is",s),t.getPushTokenDetails().then(function(t){a.default.customLabel(1,n,"token",t.token),e({state:s,subscriptionDetails:t})}).catch(function(t){a.default.warn(1,n,"Could not get push token details"),e({state:s,subscriptionDetails:null})})):(a.default.log(1,n,"MoEngage web push settings not configured. Please configure at","https://app.moengage.com/v3/#/settings/4/0"),r(o.default.ERRORS.WEB_PUSH_NOT_CONFIGURED))}).catch(function(e){r(e)})})},e.prototype.getCurrentPermissionState=function(){return null!=this.currentManager?this.currentManager.getCurrentPermissionState():Promise.reject(g)},e.prototype.getPushTokenDetails=function(){return null!=this.currentManager?this.currentManager.getPushTokenDetails():Promise.reject(g)},e.prototype.isTokenValid=function(){return null!=this.currentManager?this.currentManager.isTokenValid():Promise.reject(g)},e.prototype.removeToken=function(){return null!=this.currentManager?this.currentManager.removeToken():Promise.reject(g)},e.prototype.showNotification=function(t){var n=e.baseLogTag+".showNotification";if(null!=this.currentManager)return this.currentManager.showNotification(t);a.default.warn(1,n,g)},e.baseLogTag="NotificationManager",e}();t.default=T},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(2),r=n(5),i=n(7),s=n(32),u=n(3),l=n(28),f=n(9),d=n(0),c=n(36),S=function(){function e(e){this.mainDivs=[],this.config=e}return e.prototype.showSoftAsk=function(){var t=this,n=e.baseLogTag+".showSoftAsk";return new Promise(function(e,f){var S=t.config.optInConfig.loadTime;t.config.optInConfig.type===i.OptInConfig.TYPE.SELF_HANDLED&&(S=0),S&&a.default.log(1,n,"Delay of",S," second(s) requested before opt-in flow"),setTimeout(function(){r.default.getInstance().then(function(r){var f=function(){u.default.set(o.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,E.NOT_SHOWN),e({showHardAsk:!0,softAskState:E.NOT_SHOWN})};if(r.isChromeLike()&&"https"===d.getCurrentProtocol()&&t.config.platformSettings.chrome.domainType===i.ChromeConfig.DOMAIN_TYPE.MUTLI)f();else if(t.config.optInConfig.type===i.OptInConfig.TYPE.TWO_STEP||t.config.optInConfig.type===i.OptInConfig.TYPE.SELF_HANDLED){var S=function(){a.default.log(1,n,"Soft ask was shown"),u.default.set(o.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),u.default.set(o.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,E.SHOWN),s.default.broadcastToWindow({topic:o.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN}),s.default.deprecatedSdkCallback("soft_ask_shown"),c.default.runCallbacks(o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN)},g=function(){l.default.track(o.default.EVENT_NAMES.WEB_OPTIN_ACCEPTED),t.hideOptIn(),a.default.log(1,n,"Soft ask was allowed"),u.default.set(o.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,E.ALLOWED),e({showHardAsk:!0,softAskState:E.ALLOWED}),s.default.broadcastToWindow({topic:o.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED}),s.default.deprecatedSdkCallback("soft_ask_allowed"),c.default.runCallbacks(o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED)},T=function(){t.hideOptIn(),l.default.track(o.default.EVENT_NAMES.WEB_OPTIN_CLOSED),a.default.log(1,n,"Soft ask was dismissed"),u.default.set(o.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,E.DISMISSED),e({showHardAsk:!1,softAskState:E.DISMISSED}),s.default.broadcastToWindow({topic:o.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED}),s.default.deprecatedSdkCallback("soft_ask_closed"),c.default.runCallbacks(o.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED)},p=function(n){n=!!n,t.hideOptIn(),e({showHardAsk:n,softAskState:E.NOT_SHOWN})};t.showOptIn(S,g,T,p)}else f()})},1e3*S)})},e.prototype.showOptIn=function(t,n,s,u){var c=this,S=e.baseLogTag+".showOptIn";if(this.config.optInConfig.type===i.OptInConfig.TYPE.TWO_STEP){var E=document.getElementById("moe-push-div");null==E&&(E=document.createElement("div"),E.id="moe-push-div"),E.className="moe-push-class",r.default.getInstance().then(function(e){var r=null;if(null!=(r=e.isMobile?c.config.optInConfig.softAskConfig.mobile.customHTML:c.config.optInConfig.softAskConfig.desktop.customHTML)){E.innerHTML=r;var i=document.body.firstChild;i.parentNode.insertBefore(E,i),c.moeDiv=E;var f=document.getElementById("optInText")||document.getElementById("optInTextConventional");null==f?(a.default.error(1,S,"Error showing soft ask. Allow button id is missing"),u()):(t(),l.default.track(o.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD),f.onclick=function(){n()},window.moeRemoveBanner=function(){s()})}else a.default.error(1,S,"Error displaying soft ask"),u()})}else if(this.config.optInConfig.type===i.OptInConfig.TYPE.SELF_HANDLED){var g=f.default.get();if(g.customSoftAsk){var T=document.getElementsByClassName(g.customSoftAsk.mainClass),p=document.getElementsByClassName(g.customSoftAsk.allowClass),_=document.getElementsByClassName(g.customSoftAsk.dismissClass);if(T.length<1)a.default.error(1,S,"Could not find main class for the soft ask. Class name given:",g.customSoftAsk.mainClass),r.default.getInstance().then(function(e){(e.isChromeLike()&&c.config.platformSettings.chrome.domainType===i.ChromeConfig.DOMAIN_TYPE.HTTPS||c.config.platformSettings.chrome.domainType===i.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===d.getCurrentProtocol()||e.name===r.default.BROWSER_NAMES.SAFARI)&&(a.default.warn(1,S,"Proceeding to hard ask directly"),u(!0))});else{t(),p.length<1&&(a.default.warn(1,S,"Could not find any element for allow button. Class name given:",g.customSoftAsk.allowClass),a.default.warn(1,S,"Docs for self-handled opt in available here - ",o.default.LINKS.SELF_HANDLED_DOCS)),_.length<1&&a.default.warn(1,S,"Could not find any element for dismiss button. Class name given:",g.customSoftAsk.dismissClass);for(var h=T.length-1;h>=0;h--){var m=T[h];this.mainDivs.push(m),m.style.display="block"}for(var h=p.length-1;h>=0;h--){var m=p[h];m.onclick=function(){n()}}for(var h=_.length-1;h>=0;h--){var m=_[h];m.onclick=function(){s()}}}}else r.default.getInstance().then(function(e){e.isChromeLike()&&c.config.platformSettings.chrome.domainType===i.ChromeConfig.DOMAIN_TYPE.HTTPS||c.config.platformSettings.chrome.domainType===i.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===d.getCurrentProtocol()||e.name===r.default.BROWSER_NAMES.SAFARI?(a.default.warn(1,S,"No soft ask configured. Proceeding to hard ask directly. \n\nYou can ignore this message if you do not want any soft ask."),u(!0)):(a.default.error(1,S,"Soft ask needs to be present in case of http implementation. Can not show hard ask otherwise."),u())})}},e.prototype.hideOptIn=function(){null!=this.moeDiv&&(this.moeDiv.style.display="none"),this.mainDivs.length>0&&this.mainDivs.map(function(e){e.style.display="none"})},e.baseLogTag="SoftAskManager",e}();t.default=S;var E;!function(e){e.SHOWN="shown",e.NOT_SHOWN="not shown",e.ALLOWED="allowed",e.DISMISSED="dismissed"}(E=t.SoftAskState||(t.SoftAskState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(2),r=n(9),i=function(){function e(){}return e.loadModule=function(t){var n=e.baseLogTag+".loadModule";return null!=e.loadPromises[t.name]?e.loadPromises[t.name]:(a.default.log(1,n,"Starting to fetch module: ",t.name),e.loadPromises[t.name]=new Promise(function(n,a){e.addScript(t.src,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a=window[o.SDK_MODULES.INAPP.windowLocation],i=r.default.get(),s=new a(i);n(s)})}),e.loadPromises[t.name])},e.addScript=function(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.async=!0,document.body.appendChild(n)},e.baseLogTag="ModuleManager",e.loadPromises={},e}();t.default=i}]);